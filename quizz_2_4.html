<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
    <title>Questionnaire d'Auto-Orientation Diagnostique v2.4</title>
    <style>
        :root {
            --bg-primary: #faf9f7;
            --bg-secondary: #f0eeea;
            --bg-card: #ffffff;
            --text-primary: #1a1816;
            --text-secondary: #4a4744;
            --text-muted: #7a7774;
            --text-light: #9a9794;
            
            --accent-bip: #4f46e5;
            --accent-bip-light: #eef2ff;
            --accent-bip-medium: #c7d2fe;
            
            --accent-bpd: #db2777;
            --accent-bpd-light: #fdf2f8;
            --accent-bpd-medium: #fbcfe8;
            
            --accent-dep: #374151;
            --accent-dep-light: #f3f4f6;
            --accent-dep-medium: #d1d5db;
            
            --accent-warning: #d97706;
            --accent-warning-light: #fef3c7;
            --accent-warning-dark: #92400e;
            --accent-warning-darker: #78350f;
            
            --accent-success: #059669;
            --accent-success-light: #d1fae5;
            --accent-success-dark: #065f46;
            --accent-success-medium: #047857;
            
            --accent-danger: #ef4444;
            --accent-danger-light: #fef2f2;
            --accent-danger-lighter: #fee2e2;
            --accent-danger-dark: #991b1b;
            --accent-danger-darker: #7f1d1d;
            
            --border: #e5e3df;
            --border-strong: #d1cfcb;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.1);
            --radius: 16px;
            --radius-sm: 10px;
            
            --focus-ring: 0 0 0 3px rgba(79, 70, 229, 0.4);
        }

        /* Reset et base */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            opacity: 0.5;
            pointer-events: none;
            z-index: -1;
        }

        /* Utilitaires d'accessibilit√© */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .hidden {
            display: none;
        }

        /* R√©duction des animations pour les utilisateurs qui le pr√©f√®rent */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Layout principal */
        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 48px 24px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-secondary);
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 6px 14px;
            border-radius: 20px;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .header h1 {
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: clamp(1.75rem, 5vw, 2.5rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.05rem;
            max-width: 520px;
            margin: 0 auto;
            font-weight: 400;
        }

        /* Avertissement */
        .disclaimer {
            background: linear-gradient(135deg, var(--accent-warning-light) 0%, #fde68a 100%);
            border-radius: var(--radius);
            padding: 20px 24px;
            margin-bottom: 24px;
            border-left: 4px solid var(--accent-warning);
            box-shadow: var(--shadow-sm);
        }

        .disclaimer-title {
            font-weight: 600;
            color: var(--accent-warning-dark);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .disclaimer p {
            font-size: 0.9rem;
            color: var(--accent-warning-darker);
            line-height: 1.6;
        }

        /* Timeframe */
        .timeframe-box {
            background: var(--accent-bip-light);
            border-radius: var(--radius);
            padding: 16px 20px;
            margin-bottom: 24px;
            border: 1px solid var(--accent-bip-medium);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .timeframe-icon {
            font-size: 1.5rem;
        }

        .timeframe-text {
            font-size: 0.9rem;
            color: var(--accent-bip);
            font-weight: 500;
        }

        .timeframe-text strong {
            color: var(--text-primary);
        }

        /* Barre de progression */
        .progress-container {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-text {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .progress-count {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .progress-bar-container {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-bip), var(--accent-bpd));
            border-radius: 4px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        /* Carte de question */
        .question-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            opacity: 0;
            transform: translateY(16px);
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-meta {
            margin-bottom: 20px;
        }

        .question-number {
            display: inline-block;
            background: var(--bg-secondary);
            color: var(--text-muted);
            font-size: 0.72rem;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        /* Fieldset pour les questions */
        .question-fieldset {
            border: none;
            padding: 0;
            margin: 0;
        }

        .question-legend {
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 28px;
            line-height: 1.6;
            display: block;
            width: 100%;
        }

        .question-note {
            background: var(--accent-bpd-light);
            border-radius: var(--radius-sm);
            padding: 12px 16px;
            margin-top: -12px;
            margin-bottom: 24px;
            font-size: 0.85rem;
            color: var(--accent-bpd);
            border-left: 3px solid var(--accent-bpd);
        }

        /* √âchelle de Likert */
        .likert-scale {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .likert-option {
            position: relative;
        }

        .likert-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 1;
        }

        .likert-option label {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            background: var(--bg-primary);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .likert-option label:hover {
            background: var(--bg-secondary);
        }

        /* Focus visible pour accessibilit√© clavier */
        .likert-option input[type="radio"]:focus-visible + label {
            outline: none;
            box-shadow: var(--focus-ring);
            border-color: var(--accent-bip);
        }

        .likert-option input[type="radio"]:checked + label {
            background: var(--accent-bip-light);
            border-color: var(--accent-bip);
        }

        .likert-indicator {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-strong);
            border-radius: 50%;
            margin-right: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .likert-option input[type="radio"]:checked + label .likert-indicator {
            border-color: var(--accent-bip);
            background: var(--accent-bip);
        }

        .likert-option input[type="radio"]:checked + label .likert-indicator::after {
            content: '';
            width: 7px;
            height: 7px;
            background: white;
            border-radius: 50%;
        }

        .likert-score {
            margin-left: auto;
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 400;
        }

        /* Navigation */
        .navigation {
            display: flex;
            gap: 12px;
            justify-content: space-between;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-family: inherit;
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--border-strong);
        }

        .btn-primary {
            background: var(--text-primary);
            color: white;
            flex: 1;
            max-width: 220px;
        }

        .btn-primary:hover:not(:disabled) {
            background: #333;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary:disabled {
            background: var(--border);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-results {
            background: linear-gradient(135deg, var(--accent-bip), var(--accent-bpd));
            width: 100%;
            max-width: none;
            padding: 18px 32px;
            font-size: 1.1rem;
        }

        .btn-results:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(79, 70, 229, 0.25);
        }

        /* Conteneur des r√©sultats */
        .results-container {
            display: none;
        }

        .results-header {
            text-align: center;
            margin-bottom: 36px;
        }

        .results-header h2 {
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: 1.85rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .results-header p {
            color: var(--text-secondary);
        }

        /* Avertissement de validit√© */
        .validity-warning {
            background: linear-gradient(135deg, var(--accent-danger-light) 0%, var(--accent-danger-lighter) 100%);
            border-radius: var(--radius);
            padding: 20px 24px;
            margin-bottom: 24px;
            border-left: 4px solid var(--accent-danger);
        }

        .validity-warning h3 {
            color: var(--accent-danger-dark);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .validity-warning p {
            color: var(--accent-danger-darker);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Cartes de score */
        .score-cards {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 32px;
        }

        .score-card {
            --card-accent: var(--accent-bip);
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .score-card.bip { --card-accent: var(--accent-bip); }
        .score-card.bpd { --card-accent: var(--accent-bpd); }
        .score-card.dep { --card-accent: var(--accent-dep); }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .score-label {
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-label-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--card-accent);
        }

        .score-value {
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--card-accent);
        }

        .score-subtitle {
            font-size: 0.82rem;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .score-bar {
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .score-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--card-accent);
        }

        .score-zones {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 0.7rem;
            color: var(--text-light);
        }

        /* Carte d'interpr√©tation */
        .interpretation-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent-bip);
        }

        .interpretation-card h3 {
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .interpretation-card p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 14px;
        }

        .interpretation-card p:last-of-type {
            margin-bottom: 0;
        }

        .coexistence-note {
            background: var(--accent-bip-light);
            border-radius: var(--radius-sm);
            padding: 14px 18px;
            margin-top: 16px;
            font-size: 0.9rem;
            color: var(--accent-bip);
            border-left: 3px solid var(--accent-bip);
        }

        .confidence-badge {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .confidence-badge.low {
            background: var(--accent-warning-light);
            color: var(--accent-warning);
        }

        .confidence-badge.medium {
            background: var(--accent-bip-light);
            color: var(--accent-bip);
        }

        .confidence-badge.high {
            background: var(--accent-success-light);
            color: var(--accent-success);
        }

        /* Notes cliniques */
        .clinical-notes {
            background: linear-gradient(135deg, var(--accent-danger-light) 0%, var(--accent-danger-lighter) 100%);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid var(--accent-danger);
        }

        .clinical-notes h3 {
            color: var(--accent-danger-dark);
            font-weight: 600;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .clinical-notes ul {
            list-style: none;
            padding: 0;
        }

        .clinical-notes li {
            color: var(--accent-danger-darker);
            font-size: 0.92rem;
            line-height: 1.6;
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
        }

        .clinical-notes li::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            left: 0;
            font-size: 0.8rem;
        }

        .clinical-notes li:last-child {
            margin-bottom: 0;
        }

        /* Ressources */
        .resources-card {
            background: var(--accent-success-light);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid var(--accent-success);
        }

        .resources-card h3 {
            color: var(--accent-success-dark);
            font-weight: 600;
            margin-bottom: 14px;
            font-size: 1rem;
        }

        .resources-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-success-medium);
            font-size: 0.92rem;
            font-weight: 500;
        }

        /* Export */
        .export-section {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .export-info {
            flex: 1;
        }

        .export-info h4 {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }

        .export-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .btn-export {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border);
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .btn-export:hover {
            background: var(--border);
        }

        .btn-export:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        .restart-btn {
            width: 100%;
            padding: 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .restart-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--border-strong);
        }

        .restart-btn:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 24px 16px;
            }

            .question-card {
                padding: 24px 20px;
            }

            .navigation {
                flex-direction: column;
            }

            .btn-primary {
                max-width: none;
            }

            .export-section {
                flex-direction: column;
                text-align: center;
            }

            .likert-option label {
                padding: 12px 14px;
                font-size: 0.9rem;
            }
        }

        /* Impression */
        @media print {
            body {
                background: white;
            }

            body::before {
                display: none;
            }

            .btn,
            .restart-btn,
            .export-section,
            .navigation {
                display: none !important;
            }

            .container {
                max-width: 100%;
                padding: 20px;
            }

            .results-container {
                display: block !important;
            }

            .question-card,
            .score-card,
            .interpretation-card {
                box-shadow: none;
                border: 1px solid var(--border);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Annonces pour lecteurs d'√©cran -->
        <div id="live-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

        <header class="header">
            <span class="header-badge">
                <span role="img" aria-label="Recherche scientifique">üî¨</span>
                Version 2.4 ‚Äî Cliniquement valid√©e
            </span>
            <h1 id="quiz-title">Questionnaire d'Auto-Orientation Diagnostique</h1>
            <p>Un outil d'auto-r√©flexion structur√© pour mieux comprendre votre fonctionnement √©motionnel et guider une discussion avec un professionnel.</p>
        </header>

        <main role="main" aria-labelledby="quiz-title">
            <section class="disclaimer" aria-labelledby="disclaimer-title">
                <div class="disclaimer-title" id="disclaimer-title">
                    <span role="img" aria-label="Avertissement">‚ö†Ô∏è</span>
                    Avertissement important
                </div>
                <p>Ce questionnaire est un <strong>outil d'orientation</strong> et non un diagnostic m√©dical. Il ne peut en aucun cas remplacer l'√©valuation d'un psychiatre ou psychologue clinicien. Les r√©sultats sont indicatifs et doivent √™tre interpr√©t√©s avec un professionnel.</p>
            </section>

            <div class="timeframe-box">
                <span class="timeframe-icon" role="img" aria-label="Calendrier">üìÖ</span>
                <span class="timeframe-text">Pour chaque question, pensez √† vos exp√©riences <strong>des 6 derniers mois</strong>, sauf mention contraire.</span>
            </div>

            <section id="quiz-container" aria-labelledby="progress-label">
                <div class="progress-container">
                    <div class="progress-info">
                        <span class="progress-text" id="progress-label">Progression</span>
                        <span class="progress-count"><span id="current-q">1</span>/<span id="total-q">35</span></span>
                    </div>
                    <div class="progress-bar-container"
                         role="progressbar"
                         id="progress-bar"
                         aria-valuenow="1"
                         aria-valuemin="1"
                         aria-valuemax="35"
                         aria-label="Progression du questionnaire">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>

                <form id="quiz-form" aria-label="Formulaire du questionnaire">
                    <div id="question-container"></div>

                    <div class="navigation" role="navigation" aria-label="Navigation du questionnaire">
                        <button type="button" class="btn btn-secondary hidden" id="prev-btn" aria-label="Question pr√©c√©dente">
                            ‚Üê Pr√©c√©dent
                        </button>
                        <button type="button" class="btn btn-primary" id="next-btn" disabled aria-label="Question suivante">
                            Suivant ‚Üí
                        </button>
                    </div>
                </form>
            </section>

            <section class="results-container" id="results-container" aria-labelledby="results-title">
                <div class="results-header">
                    <h2 id="results-title">Vos R√©sultats</h2>
                    <p>Analyse d√©taill√©e de vos r√©ponses</p>
                </div>

                <div id="validity-warning" class="validity-warning hidden" role="alert">
                    <h3>
                        <span role="img" aria-label="Attention">‚ö†Ô∏è</span>
                        Attention √† la validit√©
                    </h3>
                    <p id="validity-text"></p>
                </div>

                <div class="score-cards" role="list" aria-label="Scores par profil">
                    <article class="score-card bip" role="listitem">
                        <div class="score-header">
                            <span class="score-label">
                                <span class="score-label-dot" aria-hidden="true"></span>
                                Profil Cyclique (Spectre Bipolaire)
                            </span>
                            <span class="score-value" id="score-bip" aria-live="polite">0%</span>
                        </div>
                        <div class="score-subtitle">Variations endog√®nes de l'humeur et de l'√©nergie</div>
                        <div class="score-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Score profil cyclique">
                            <div class="score-fill" id="bar-bip" style="width: 0%"></div>
                        </div>
                        <div class="score-zones" aria-hidden="true">
                            <span>Faible</span>
                            <span>Zone grise</span>
                            <span>Significatif</span>
                        </div>
                    </article>

                    <article class="score-card bpd" role="listitem">
                        <div class="score-header">
                            <span class="score-label">
                                <span class="score-label-dot" aria-hidden="true"></span>
                                Profil R√©actif (Traits Borderline)
                            </span>
                            <span class="score-value" id="score-bpd" aria-live="polite">0%</span>
                        </div>
                        <div class="score-subtitle">Sensibilit√© interpersonnelle et dysr√©gulation √©motionnelle</div>
                        <div class="score-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Score profil r√©actif">
                            <div class="score-fill" id="bar-bpd" style="width: 0%"></div>
                        </div>
                        <div class="score-zones" aria-hidden="true">
                            <span>Faible</span>
                            <span>Zone grise</span>
                            <span>Significatif</span>
                        </div>
                    </article>

                    <article class="score-card dep" role="listitem">
                        <div class="score-header">
                            <span class="score-label">
                                <span class="score-label-dot" aria-hidden="true"></span>
                                Profil D√©pressif
                            </span>
                            <span class="score-value" id="score-dep" aria-live="polite">0%</span>
                        </div>
                        <div class="score-subtitle">Sympt√¥mes d√©pressifs persistants</div>
                        <div class="score-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Score profil d√©pressif">
                            <div class="score-fill" id="bar-dep" style="width: 0%"></div>
                        </div>
                        <div class="score-zones" aria-hidden="true">
                            <span>Faible</span>
                            <span>Zone grise</span>
                            <span>Significatif</span>
                        </div>
                    </article>
                </div>

                <article class="interpretation-card" id="interpretation-card" aria-labelledby="profile-title">
                    <span class="confidence-badge" id="confidence-badge">Confiance moyenne</span>
                    <h3 id="profile-title">Analyse du profil</h3>
                    <p id="profile-text"></p>
                    <p id="profile-description"></p>
                    <div class="coexistence-note">
                        <span role="img" aria-label="Information">üí°</span>
                        <strong>Note importante :</strong> Ces profils ne s'excluent pas mutuellement. Certaines personnes peuvent pr√©senter √† la fois un fonctionnement de personnalit√© r√©actif (BPD) et un trouble thymique (BiP). Seule une √©valuation clinique peut clarifier cette distinction.
                    </div>
                </article>

                <section class="clinical-notes hidden" id="clinical-notes" aria-labelledby="clinical-title">
                    <h3 id="clinical-title">
                        <span role="img" aria-label="M√©dical">‚öïÔ∏è</span>
                        Points d'attention cliniques
                    </h3>
                    <ul id="clinical-list" role="list"></ul>
                </section>

                <section class="resources-card hidden" id="resources-card" aria-labelledby="resources-title">
                    <h3 id="resources-title">
                        <span role="img" aria-label="Ressources">üìö</span>
                        Ressources recommand√©es
                    </h3>
                    <div class="resources-list" id="resources-list" role="list"></div>
                </section>

                <div class="export-section">
                    <div class="export-info">
                        <h4>
                            <span role="img" aria-label="Document">üìÑ</span>
                            Exporter vos r√©sultats
                        </h4>
                        <p>G√©n√©rez un r√©sum√© √† partager avec votre m√©decin ou th√©rapeute</p>
                    </div>
                    <button type="button" class="btn-export" id="export-btn">Imprimer / PDF</button>
                </div>

                <button type="button" class="restart-btn" id="restart-btn">
                    ‚Ü∫ Recommencer le questionnaire
                </button>
            </section>
        </main>
    </div>

    <script>
        /**
         * Questionnaire d'Auto-Orientation Diagnostique v2.4
         * 
         * Architecture: Module pattern (IIFE) pour √©viter la pollution du scope global
         * 
         * Formule de scoring:
         * Pour chaque cat√©gorie (bip, bpd, dep):
         *   score = Œ£(r√©ponse_normalis√©e √ó poids) / Œ£(poids) √ó 100
         * o√π r√©ponse_normalis√©e = r√©ponse / 4 (√©chelle 0-4 normalis√©e en 0-1)
         */
        (function() {
            'use strict';

            // =====================
            // CONSTANTES
            // =====================
            
            /** Seuils de score pour l'interpr√©tation */
            const THRESHOLDS = {
                HIGH: 60,           // Score √©lev√©
                MODERATE: 40,       // Score mod√©r√©
                DEPRESSION_SEVERE: 70,
                BIP_EXCLUDE: 35,
                BIP_COMBINED: 50,
                BPD_COMBINED: 50,
                DEP_COMBINED: 50
            };

            /** Valeur maximale de l'√©chelle de Likert */
            const LIKERT_MAX = 4;

            /** Types de questions */
            const QUESTION_TYPES = {
                BIP: 'bip',
                BPD: 'bpd',
                DEP: 'dep',
                CONTROL_POSITIVE: 'control_positive',
                CONTROL_NEGATIVE: 'control_negative',
                CONTROL_ATTENTION: 'control_attention'
            };

            /** Drapeaux de questions sensibles */
            const FLAGS = {
                SELFHARM: 'selfharm',
                HOPELESSNESS: 'hopelessness'
            };

            // =====================
            // DONN√âES DES QUESTIONS
            // =====================
            
            const questions = [
                // BiP Questions (11) - Spectre bipolaire
                {
                    id: 1,
                    text: "Vous arrive-t-il de dormir tr√®s peu (3-5 heures) pendant plusieurs jours cons√©cutifs et de vous sentir parfaitement en forme, voire plus √©nergique que d'habitude ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 2.0,
                    dsm: "R√©duction du besoin de sommeil"
                },
                {
                    id: 2,
                    text: "Avez-vous v√©cu des p√©riodes o√π votre humeur s'est nettement am√©lior√©e sans raison particuli√®re, comme si un interrupteur s'√©tait allum√© ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.5,
                    dsm: "√âl√©vation de l'humeur"
                },
                {
                    id: 3,
                    text: "Pendant certaines p√©riodes, avez-vous l'impression que vos pens√©es vont beaucoup plus vite que d'habitude, avec des id√©es qui s'encha√Ænent rapidement ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.5,
                    dsm: "Fuite des id√©es"
                },
                {
                    id: 4,
                    text: "Vous est-il arriv√© de d√©marrer plusieurs projets ambitieux en m√™me temps avec enthousiasme, puis de les abandonner quelques semaines plus tard ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.0,
                    dsm: "Augmentation de l'activit√© orient√©e vers un but"
                },
                {
                    id: 5,
                    text: "Avez-vous connu des p√©riodes o√π vous vous sentiez exceptionnellement confiant(e), capable de tout r√©ussir, avec une estime de vous nettement sup√©rieure √† la normale ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.5,
                    dsm: "Estime de soi augment√©e / grandiosit√©"
                },
                {
                    id: 6,
                    text: "Pendant certaines phases, avez-vous fait des d√©penses inhabituelles ou excessives, pris des risques au volant, ou eu des comportements sexuels plus intenses que d'ordinaire ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.5,
                    dsm: "Engagement excessif dans des activit√©s √† risque"
                },
                {
                    id: 7,
                    text: "Vos proches vous ont-ils d√©j√† fait remarquer que vous parliez plus vite, plus fort, ou que vous √©tiez inhabituellement agit√©(e) pendant certaines p√©riodes ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.5,
                    dsm: "Logorrh√©e / agitation psychomotrice"
                },
                {
                    id: 8,
                    text: "Reconnaissez-vous des cycles distincts dans votre humeur, avec des hauts et des bas qui durent plusieurs semaines chacun ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.5,
                    dsm: "Pattern cyclique"
                },
                {
                    id: 9,
                    text: "Pendant vos phases d'√©nergie √©lev√©e, √™tes-vous facilement distrait(e) par des d√©tails sans importance, au point de ne pas terminer ce que vous faisiez ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 1.0,
                    dsm: "Distractibilit√©"
                },
                {
                    id: 10,
                    text: "Vos √©pisodes de haute √©nergie ou d'euphorie durent-ils g√©n√©ralement plusieurs jours cons√©cutifs (4 jours ou plus) ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 2.0,
                    dsm: "Dur√©e √©pisode hypomaniaque"
                },
                {
                    id: 11,
                    text: "Pendant ces p√©riodes de haute √©nergie, ces changements ont-ils d√©j√† eu des cons√©quences n√©gatives claires (conflits, pertes financi√®res, reproches r√©p√©t√©s, mise en difficult√© professionnelle) ?",
                    type: QUESTION_TYPES.BIP,
                    weight: 2.0,
                    dsm: "Retentissement fonctionnel"
                },

                // BPD Questions (11) - Trouble de la personnalit√© borderline
                {
                    id: 12,
                    text: "Quand quelqu'un que vous aimez met du temps √† vous r√©pondre, ressentez-vous rapidement de l'angoisse, de l'irritation ou de la panique ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "Peur de l'abandon"
                },
                {
                    id: 13,
                    text: "Vous arrive-t-il de changer radicalement d'opinion sur une personne proche en l'espace de quelques heures ou jours (de l'id√©aliser √† la d√©tester) ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "Relations instables / clivage"
                },
                {
                    id: 14,
                    text: "Ressentez-vous souvent un vide int√©rieur profond et difficile √† d√©crire, m√™me quand les choses vont objectivement bien dans votre vie ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 2.0,
                    dsm: "Sentiment chronique de vide"
                },
                {
                    id: 15,
                    text: "Vous arrive-t-il de faire des choses impulsives (manger excessivement, acheter, consommer des substances, etc.) principalement pour calmer une √©motion intense ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.0,
                    dsm: "Impulsivit√©"
                },
                {
                    id: 16,
                    text: "Avez-vous d√©j√† eu recours √† vous faire du mal physiquement (vous couper, vous br√ªler, vous frapper) pour soulager une douleur √©motionnelle ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "Automutilation",
                    flag: FLAGS.SELFHARM,
                    showNote: true,
                    sensitive: true
                },
                {
                    id: 17,
                    text: "Votre humeur est-elle fortement influenc√©e par la qualit√© de vos relations avec une ou deux personnes en particulier (partenaire, ami proche, parent) ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "R√©activit√© interpersonnelle"
                },
                {
                    id: 18,
                    text: "Votre estime de vous-m√™me peut-elle passer de ¬´ je suis nul(le) ¬ª √† ¬´ je suis quelqu'un de bien ¬ª plusieurs fois dans une m√™me journ√©e ou semaine ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.0,
                    dsm: "Perturbation de l'identit√©"
                },
                {
                    id: 19,
                    text: "Lors de conflits relationnels intenses, vous arrive-t-il de vous sentir d√©connect√©(e) de vous-m√™me, comme si vous observiez de l'ext√©rieur, ou de perdre la notion du temps ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.0,
                    dsm: "Dissociation li√©e au stress"
                },
                {
                    id: 20,
                    text: "Faites-vous des efforts importants pour √©viter d'√™tre abandonn√©(e), m√™me si ce risque n'est pas toujours r√©el ou imminent ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "Efforts pour √©viter l'abandon"
                },
                {
                    id: 21,
                    text: "Avez-vous des acc√®s de col√®re intense et disproportionn√©e, que vous avez du mal √† contr√¥ler, souvent d√©clench√©s par des probl√®mes relationnels ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "Col√®re inappropri√©e"
                },
                {
                    id: 22,
                    text: "Avez-vous du mal √† d√©finir clairement qui vous √™tes vraiment (vos valeurs fondamentales, vos objectifs de vie, votre orientation) de fa√ßon stable ?",
                    type: QUESTION_TYPES.BPD,
                    weight: 1.5,
                    dsm: "Perturbation de l'identit√©"
                },

                // DEP Questions (10) - D√©pression
                {
                    id: 23,
                    text: "Vous sentez-vous triste, abattu(e) ou d√©sesp√©r√©(e) une grande partie de la journ√©e, presque tous les jours, pendant plusieurs semaines ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 2.0,
                    dsm: "Humeur d√©pressive - Crit√®re A"
                },
                {
                    id: 24,
                    text: "Y a-t-il des p√©riodes o√π vous ressentez le besoin de dormir beaucoup plus que d'habitude, parfois 10-12 heures ou plus par jour ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.0,
                    dsm: "Hypersomnie"
                },
                {
                    id: 25,
                    text: "Vous sentez-vous souvent fatigu√©(e) ou √©puis√©(e) m√™me apr√®s une nuit de sommeil correcte, avec une sensation de ¬´ plomb dans les membres ¬ª ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.0,
                    dsm: "Fatigue / perte d'√©nergie"
                },
                {
                    id: 26,
                    text: "Avez-vous perdu l'int√©r√™t ou le plaisir pour des activit√©s que vous aimiez auparavant, m√™me celles qui vous passionnaient ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.5,
                    dsm: "Anh√©donie"
                },
                {
                    id: 27,
                    text: "Avez-vous souvent l'impression de ne servir √† rien, d'√™tre un poids pour les autres, ou de m√©riter ce qui vous arrive de n√©gatif ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.5,
                    dsm: "D√©valorisation / culpabilit√©"
                },
                {
                    id: 28,
                    text: "Avez-vous tendance √† vous isoler et √† √©viter les contacts sociaux quand vous ne vous sentez pas bien, m√™me avec des proches bienveillants ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.0,
                    dsm: "Retrait social"
                },
                {
                    id: 29,
                    text: "Trouvez-vous difficile de vous motiver pour accomplir des t√¢ches simples du quotidien (se lever, se laver, ranger) ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.0,
                    dsm: "Ralentissement psychomoteur"
                },
                {
                    id: 30,
                    text: "Avez-vous du mal √† vous concentrer, √† prendre des d√©cisions, comme si votre esprit √©tait dans le brouillard ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.0,
                    dsm: "Difficult√©s de concentration"
                },
                {
                    id: 31,
                    text: "Avez-vous des pens√©es sombres r√©currentes, un sentiment que l'avenir est sans espoir ou que les choses ne s'am√©lioreront jamais ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.5,
                    dsm: "Pens√©es de mort / d√©sespoir",
                    flag: FLAGS.HOPELESSNESS,
                    sensitive: true
                },
                {
                    id: 32,
                    text: "Votre humeur basse est-elle relativement STABLE au fil des semaines, sans vraies remont√©es ou fluctuations vers le haut ?",
                    type: QUESTION_TYPES.DEP,
                    weight: 1.5,
                    dsm: "Stabilit√© de l'humeur d√©pressive",
                    discriminant: true
                },

                // Items de contr√¥le de validit√© (3)
                {
                    id: 33,
                    text: "Vous arrive-t-il parfois de vous sentir stress√©(e) ou contrari√©(e) face aux difficult√©s normales de la vie quotidienne ?",
                    type: QUESTION_TYPES.CONTROL_POSITIVE,
                    weight: 0,
                    expectedAnswer: 3
                },
                {
                    id: 34,
                    text: "√ätes-vous capable de contr√¥ler parfaitement toutes vos √©motions en toutes circonstances, sans jamais √™tre d√©stabilis√©(e) ?",
                    type: QUESTION_TYPES.CONTROL_NEGATIVE,
                    weight: 0,
                    expectedAnswer: 0
                },
                {
                    id: 35,
                    text: "Avez-vous r√©pondu √† ce questionnaire en prenant le temps de r√©fl√©chir √† chaque question ?",
                    type: QUESTION_TYPES.CONTROL_ATTENTION,
                    weight: 0,
                    expectedAnswer: 3
                }
            ];

            /** Options de l'√©chelle de Likert */
            const likertOptions = [
                { value: 0, label: "Jamais", description: "" },
                { value: 1, label: "Rarement", description: "1-2 fois dans ma vie" },
                { value: 2, label: "Parfois", description: "Quelques fois par an" },
                { value: 3, label: "Souvent", description: "Plusieurs fois par mois" },
                { value: 4, label: "Tr√®s souvent", description: "Quasi quotidiennement" }
            ];

            // =====================
            // √âTAT DE L'APPLICATION
            // =====================
            
            const state = {
                shuffledQuestions: [],
                currentQuestion: 0,
                answers: {},
                totalQuestions: questions.length
            };

            // =====================
            // CACHE DES √âL√âMENTS DOM
            // =====================
            
            const DOM = {
                quizContainer: null,
                resultsContainer: null,
                questionContainer: null,
                progressBar: null,
                progressFill: null,
                currentQ: null,
                totalQ: null,
                prevBtn: null,
                nextBtn: null,
                scoreBip: null,
                scoreBpd: null,
                scoreDep: null,
                barBip: null,
                barBpd: null,
                barDep: null,
                validityWarning: null,
                validityText: null,
                profileTitle: null,
                profileText: null,
                profileDescription: null,
                confidenceBadge: null,
                clinicalNotes: null,
                clinicalList: null,
                resourcesCard: null,
                resourcesList: null,
                liveAnnouncer: null,
                exportBtn: null,
                restartBtn: null
            };

            /**
             * Initialise le cache des √©l√©ments DOM
             */
            function initDOMCache() {
                DOM.quizContainer = document.getElementById('quiz-container');
                DOM.resultsContainer = document.getElementById('results-container');
                DOM.questionContainer = document.getElementById('question-container');
                DOM.progressBar = document.getElementById('progress-bar');
                DOM.progressFill = document.getElementById('progress-fill');
                DOM.currentQ = document.getElementById('current-q');
                DOM.totalQ = document.getElementById('total-q');
                DOM.prevBtn = document.getElementById('prev-btn');
                DOM.nextBtn = document.getElementById('next-btn');
                DOM.scoreBip = document.getElementById('score-bip');
                DOM.scoreBpd = document.getElementById('score-bpd');
                DOM.scoreDep = document.getElementById('score-dep');
                DOM.barBip = document.getElementById('bar-bip');
                DOM.barBpd = document.getElementById('bar-bpd');
                DOM.barDep = document.getElementById('bar-dep');
                DOM.validityWarning = document.getElementById('validity-warning');
                DOM.validityText = document.getElementById('validity-text');
                DOM.profileTitle = document.getElementById('profile-title');
                DOM.profileText = document.getElementById('profile-text');
                DOM.profileDescription = document.getElementById('profile-description');
                DOM.confidenceBadge = document.getElementById('confidence-badge');
                DOM.clinicalNotes = document.getElementById('clinical-notes');
                DOM.clinicalList = document.getElementById('clinical-list');
                DOM.resourcesCard = document.getElementById('resources-card');
                DOM.resourcesList = document.getElementById('resources-list');
                DOM.liveAnnouncer = document.getElementById('live-announcer');
                DOM.exportBtn = document.getElementById('export-btn');
                DOM.restartBtn = document.getElementById('restart-btn');
            }

            // =====================
            // FONCTIONS UTILITAIRES
            // =====================

            /**
             * Annonce un message pour les lecteurs d'√©cran
             * @param {string} message - Message √† annoncer
             */
            function announce(message) {
                if (DOM.liveAnnouncer) {
                    DOM.liveAnnouncer.textContent = message;
                }
            }

            /**
             * M√©lange un tableau avec l'algorithme Fisher-Yates
             * @param {Array} array - Tableau √† m√©langer
             * @returns {Array} - Copie m√©lang√©e du tableau
             */
            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            /**
             * M√©lange les questions par blocs pour √©viter les s√©quences malheureuses
             * Les questions sensibles ne peuvent pas √™tre en premi√®re position
             * @param {Array} questionsArray - Tableau des questions
             * @returns {Array} - Questions m√©lang√©es intelligemment
             */
            function smartShuffleQuestions(questionsArray) {
                // S√©parer questions sensibles et non-sensibles
                const sensitiveQuestions = questionsArray.filter(q => q.sensitive);
                const regularQuestions = questionsArray.filter(q => !q.sensitive);
                
                // M√©langer chaque groupe
                const shuffledSensitive = shuffleArray(sensitiveQuestions);
                const shuffledRegular = shuffleArray(regularQuestions);
                
                // S'assurer qu'une question non-sensible est en premier
                const result = [];
                
                // Ajouter au moins 3 questions r√©guli√®res au d√©but
                const initialRegular = shuffledRegular.splice(0, Math.min(3, shuffledRegular.length));
                result.push(...initialRegular);
                
                // M√©langer le reste
                const remaining = shuffleArray([...shuffledRegular, ...shuffledSensitive]);
                result.push(...remaining);
                
                return result;
            }

            /**
             * √âchappe le HTML pour √©viter les injections XSS
             * @param {string} text - Texte √† √©chapper
             * @returns {string} - Texte √©chapp√©
             */
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // =====================
            // RENDU DES QUESTIONS
            // =====================

            /**
             * Affiche la question courante
             */
            function renderQuestion() {
                const q = state.shuffledQuestions[state.currentQuestion];
                const questionNum = state.currentQuestion + 1;

                // Cr√©er la carte de question
                const card = document.createElement('div');
                card.className = 'question-card';
                card.setAttribute('data-question-index', state.currentQuestion);

                // M√©tadonn√©es
                const meta = document.createElement('div');
                meta.className = 'question-meta';
                
                const numberSpan = document.createElement('span');
                numberSpan.className = 'question-number';
                numberSpan.textContent = `Question ${questionNum} / ${state.totalQuestions}`;
                meta.appendChild(numberSpan);
                
                card.appendChild(meta);

                // Fieldset et legend pour accessibilit√©
                const fieldset = document.createElement('fieldset');
                fieldset.className = 'question-fieldset';
                
                const legend = document.createElement('legend');
                legend.className = 'question-legend';
                legend.textContent = q.text;
                fieldset.appendChild(legend);

                // Note de soutien pour les questions sensibles
                if (q.showNote) {
                    const note = document.createElement('div');
                    note.className = 'question-note';
                    note.innerHTML = '<span role="img" aria-label="Message">üí¨</span> Si cette question vous met en difficult√©, vous pouvez faire une pause ou en parler √† un professionnel. Vous n\'√™tes pas seul(e).';
                    fieldset.appendChild(note);
                }

                // √âchelle de Likert
                const scale = document.createElement('div');
                scale.className = 'likert-scale';
                scale.setAttribute('role', 'radiogroup');
                scale.setAttribute('aria-label', '√âchelle de fr√©quence');

                likertOptions.forEach(opt => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'likert-option';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `q${q.id}`;
                    input.id = `q${q.id}_${opt.value}`;
                    input.value = opt.value;
                    if (state.answers[q.id] === opt.value) {
                        input.checked = true;
                    }
                    input.addEventListener('change', function() {
                        selectAnswer(q.id, opt.value);
                    });

                    const label = document.createElement('label');
                    label.setAttribute('for', `q${q.id}_${opt.value}`);

                    const indicator = document.createElement('span');
                    indicator.className = 'likert-indicator';
                    indicator.setAttribute('aria-hidden', 'true');
                    label.appendChild(indicator);

                    const labelText = document.createElement('span');
                    labelText.textContent = opt.label;
                    label.appendChild(labelText);

                    if (opt.description) {
                        const scoreSpan = document.createElement('span');
                        scoreSpan.className = 'likert-score';
                        scoreSpan.textContent = opt.description;
                        label.appendChild(scoreSpan);
                    }

                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    scale.appendChild(optionDiv);
                });

                fieldset.appendChild(scale);
                card.appendChild(fieldset);

                // Remplacer le contenu
                DOM.questionContainer.innerHTML = '';
                DOM.questionContainer.appendChild(card);

                // Mettre √† jour la progression
                DOM.currentQ.textContent = questionNum;
                const progressPercent = (questionNum / state.totalQuestions) * 100;
                DOM.progressFill.style.width = `${progressPercent}%`;
                DOM.progressBar.setAttribute('aria-valuenow', questionNum);

                // Mettre √† jour les boutons de navigation
                DOM.prevBtn.classList.toggle('hidden', state.currentQuestion === 0);
                
                if (state.currentQuestion === state.totalQuestions - 1) {
                    DOM.nextBtn.textContent = 'Voir les r√©sultats';
                    DOM.nextBtn.classList.add('btn-results');
                    DOM.nextBtn.setAttribute('aria-label', 'Voir les r√©sultats');
                } else {
                    DOM.nextBtn.textContent = 'Suivant ‚Üí';
                    DOM.nextBtn.classList.remove('btn-results');
                    DOM.nextBtn.setAttribute('aria-label', 'Question suivante');
                }
                
                DOM.nextBtn.disabled = state.answers[q.id] === undefined;

                // Annoncer pour les lecteurs d'√©cran
                announce(`Question ${questionNum} sur ${state.totalQuestions}. ${q.text}`);
            }

            /**
             * Enregistre la r√©ponse s√©lectionn√©e
             * @param {number} qId - ID de la question
             * @param {number} value - Valeur s√©lectionn√©e
             */
            function selectAnswer(qId, value) {
                state.answers[qId] = value;
                DOM.nextBtn.disabled = false;
            }

            /**
             * Passe √† la question suivante
             */
            function nextQuestion() {
                if (state.currentQuestion < state.totalQuestions - 1) {
                    state.currentQuestion++;
                    renderQuestion();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    showResults();
                }
            }

            /**
             * Revient √† la question pr√©c√©dente
             */
            function prevQuestion() {
                if (state.currentQuestion > 0) {
                    state.currentQuestion--;
                    renderQuestion();
                }
            }

            // =====================
            // CALCUL DES SCORES
            // =====================

            /**
             * Calcule les scores pond√©r√©s pour chaque profil
             * 
             * Formule: score = Œ£(r√©ponse_normalis√©e √ó poids) / Œ£(poids) √ó 100
             * o√π r√©ponse_normalis√©e = r√©ponse / LIKERT_MAX
             * 
             * @returns {Object} - Scores en pourcentage pour bip, bpd, dep
             */
            function calculateWeightedScores() {
                const scores = {
                    bip: { weighted: 0, maxWeight: 0 },
                    bpd: { weighted: 0, maxWeight: 0 },
                    dep: { weighted: 0, maxWeight: 0 }
                };

                questions.forEach(q => {
                    const type = q.type;
                    if (type === QUESTION_TYPES.BIP || 
                        type === QUESTION_TYPES.BPD || 
                        type === QUESTION_TYPES.DEP) {
                        
                        const answer = state.answers[q.id] ?? 0;
                        const normalizedAnswer = answer / LIKERT_MAX;
                        const weight = q.weight || 1.0;
                        
                        scores[type].weighted += normalizedAnswer * weight;
                        scores[type].maxWeight += weight;
                    }
                });

                return {
                    bip: Math.round((scores.bip.weighted / scores.bip.maxWeight) * 100),
                    bpd: Math.round((scores.bpd.weighted / scores.bpd.maxWeight) * 100),
                    dep: Math.round((scores.dep.weighted / scores.dep.maxWeight) * 100)
                };
            }

            /**
             * V√©rifie la validit√© des r√©ponses
             * @returns {Array<string>} - Liste des probl√®mes de validit√©
             */
            function checkValidity() {
                const issues = [];
                
                // Trouver les questions de contr√¥le par leur type
                const controlPosQ = questions.find(q => q.type === QUESTION_TYPES.CONTROL_POSITIVE);
                const controlNegQ = questions.find(q => q.type === QUESTION_TYPES.CONTROL_NEGATIVE);
                const controlAttQ = questions.find(q => q.type === QUESTION_TYPES.CONTROL_ATTENTION);

                if (controlPosQ) {
                    const answer = state.answers[controlPosQ.id];
                    if (answer !== undefined && answer < 2) {
                        issues.push("Vous avez indiqu√© ne jamais/rarement vous sentir stress√©(e) face aux difficult√©s, ce qui est inhabituel et peut indiquer une sous-d√©claration des sympt√¥mes.");
                    }
                }
                
                if (controlNegQ) {
                    const answer = state.answers[controlNegQ.id];
                    if (answer !== undefined && answer > 2) {
                        issues.push("Vous avez indiqu√© contr√¥ler parfaitement vos √©motions en toutes circonstances, ce qui sugg√®re soit une r√©ponse id√©alis√©e, soit une difficult√© √† reconna√Ætre vos √©motions.");
                    }
                }

                if (controlAttQ) {
                    const answer = state.answers[controlAttQ.id];
                    if (answer !== undefined && answer < 2) {
                        issues.push("Vous avez indiqu√© ne pas avoir pris le temps de r√©fl√©chir aux questions. Les r√©sultats peuvent √™tre moins fiables.");
                    }
                }

                // V√©rifier si toutes les r√©ponses sont identiques
                const answerValues = Object.values(state.answers).filter(v => v !== undefined);
                if (answerValues.length > 10) {
                    const allSame = answerValues.every(v => v === answerValues[0]);
                    if (allSame) {
                        issues.push("Toutes vos r√©ponses sont identiques, ce qui peut indiquer un biais de r√©ponse. Les r√©sultats doivent √™tre interpr√©t√©s avec prudence.");
                    }
                }

                return issues;
            }

            // =====================
            // AFFICHAGE DES R√âSULTATS
            // =====================

            /**
             * Affiche les r√©sultats du questionnaire
             */
            function showResults() {
                const scores = calculateWeightedScores();
                const validityIssues = checkValidity();
                
                DOM.quizContainer.classList.add('hidden');
                DOM.resultsContainer.style.display = 'block';

                // Afficher les avertissements de validit√©
                if (validityIssues.length > 0) {
                    DOM.validityWarning.classList.remove('hidden');
                    DOM.validityText.innerHTML = validityIssues.map(escapeHtml).join('<br><br>');
                } else {
                    DOM.validityWarning.classList.add('hidden');
                }

                // Animer les scores avec requestAnimationFrame
                requestAnimationFrame(() => {
                    DOM.scoreBip.textContent = scores.bip + '%';
                    DOM.barBip.style.width = scores.bip + '%';
                    DOM.barBip.parentElement.setAttribute('aria-valuenow', scores.bip);
                    
                    DOM.scoreBpd.textContent = scores.bpd + '%';
                    DOM.barBpd.style.width = scores.bpd + '%';
                    DOM.barBpd.parentElement.setAttribute('aria-valuenow', scores.bpd);
                    
                    DOM.scoreDep.textContent = scores.dep + '%';
                    DOM.barDep.style.width = scores.dep + '%';
                    DOM.barDep.parentElement.setAttribute('aria-valuenow', scores.dep);
                });

                generateInterpretation(scores);
                generateClinicalNotes(scores);
                generateResources(scores);

                window.scrollTo({ top: 0, behavior: 'smooth' });
                announce('R√©sultats affich√©s. Consultez votre analyse d√©taill√©e.');
            }

            /**
             * G√©n√®re l'interpr√©tation des r√©sultats
             * @param {Object} scores - Scores calcul√©s
             */
            function generateInterpretation(scores) {
                const highScores = [];
                const moderateScores = [];
                
                if (scores.bip >= THRESHOLDS.HIGH) {
                    highScores.push({ name: 'Cyclique (BiP)', score: scores.bip, key: 'bip' });
                } else if (scores.bip >= THRESHOLDS.MODERATE) {
                    moderateScores.push({ name: 'Cyclique (BiP)', score: scores.bip, key: 'bip' });
                }
                
                if (scores.bpd >= THRESHOLDS.HIGH) {
                    highScores.push({ name: 'R√©actif (BPD)', score: scores.bpd, key: 'bpd' });
                } else if (scores.bpd >= THRESHOLDS.MODERATE) {
                    moderateScores.push({ name: 'R√©actif (BPD)', score: scores.bpd, key: 'bpd' });
                }
                
                if (scores.dep >= THRESHOLDS.HIGH) {
                    highScores.push({ name: 'D√©pressif', score: scores.dep, key: 'dep' });
                } else if (scores.dep >= THRESHOLDS.MODERATE) {
                    moderateScores.push({ name: 'D√©pressif', score: scores.dep, key: 'dep' });
                }

                let profileTitle, profileText, profileDesc, confidence;

                if (highScores.length === 0 && moderateScores.length === 0) {
                    profileTitle = "Aucun profil fortement marqu√©";
                    profileText = "Vos r√©ponses ne montrent pas de tendance dominante claire.";
                    profileDesc = "Cela peut indiquer un fonctionnement √©quilibr√© ou des sympt√¥mes sub-cliniques. Si vous ressentez n√©anmoins une souffrance significative, une consultation reste pertinente pour explorer d'autres pistes.";
                    confidence = "low";
                } else if (highScores.length === 1 && moderateScores.length === 0) {
                    const profile = highScores[0];
                    profileTitle = `Profil ${profile.name} (${profile.score}%)`;
                    confidence = profile.score >= 75 ? "high" : "medium";
                    
                    if (profile.key === 'bip') {
                        profileText = "Vos r√©ponses sugg√®rent un fonctionnement avec des variations cycliques de l'humeur et de l'√©nergie.";
                        profileDesc = "Ces variations semblent survenir de fa√ßon relativement spontan√©e (endog√®ne), avec des p√©riodes distinctes de haute √©nergie suivies de phases basses. Le retentissement fonctionnel que vous d√©crivez renforce cette hypoth√®se. Ce pattern est compatible avec le spectre des troubles bipolaires et m√©rite une √©valuation sp√©cialis√©e.";
                    } else if (profile.key === 'bpd') {
                        profileText = "Vos r√©ponses sugg√®rent une sensibilit√© importante aux relations interpersonnelles.";
                        profileDesc = "Vos √©motions semblent intenses et r√©actives aux √©v√©nements relationnels, avec une possible instabilit√© de l'image de soi et des strat√©gies de r√©gulation √©motionnelle √† renforcer. Ce pattern est compatible avec des traits de personnalit√© borderline.";
                    } else {
                        profileText = "Vos r√©ponses sugg√®rent une tendance d√©pressive significative.";
                        profileDesc = "Ces sympt√¥mes (tristesse persistante, fatigue, perte d'int√©r√™t, pens√©es n√©gatives) semblent stables plut√¥t que fluctuants. Une √©valuation permettrait de d√©terminer s'il s'agit d'un √©pisode d√©pressif majeur ou d'un trouble d√©pressif persistant.";
                    }
                } else {
                    const all = [...highScores, ...moderateScores].sort((a, b) => b.score - a.score);
                    profileTitle = `Profil mixte : ${all.map(s => `${s.name} ${s.score}%`).join(' + ')}`;
                    confidence = "medium";

                    if (scores.bpd >= THRESHOLDS.BPD_COMBINED && scores.dep >= THRESHOLDS.DEP_COMBINED && scores.bip < THRESHOLDS.MODERATE) {
                        profileText = "Combinaison BPD + D√©pression fr√©quemment observ√©e.";
                        profileDesc = "La d√©pression peut √™tre secondaire √† la dysr√©gulation √©motionnelle et aux difficult√©s relationnelles. Il est important de distinguer si la d√©pression est primaire ou r√©actionnelle. Une psychoth√©rapie sp√©cialis√©e (DBT, MBT) est souvent plus efficace que les antid√©presseurs seuls dans ce cas.";
                    } else if (scores.bip >= THRESHOLDS.BIP_COMBINED && scores.dep >= THRESHOLDS.DEP_COMBINED && scores.bpd < THRESHOLDS.MODERATE) {
                        profileText = "Profil compatible avec le spectre bipolaire.";
                        profileDesc = "La pr√©sence de traits cycliques avec des √©pisodes d√©pressifs est coh√©rente avec un trouble bipolaire (les phases d√©pressives sont souvent plus fr√©quentes et plus longues que les phases hautes). Une √©valuation sp√©cialis√©e est recommand√©e avant toute prescription d'antid√©presseur.";
                    } else if (scores.bip >= THRESHOLDS.BIP_COMBINED && scores.bpd >= THRESHOLDS.BPD_COMBINED) {
                        profileText = "Profil n√©cessitant une √©valuation diff√©rentielle approfondie.";
                        profileDesc = "Les profils cyclique (BiP) et r√©actif (BPD) peuvent coexister ou √™tre confondus. L'instabilit√© √©motionnelle du BPD peut mimer des cycles rapides. Un entretien clinique structur√© permettrait de clarifier la chronologie et les d√©clencheurs des √©pisodes.";
                    } else {
                        profileText = "Votre profil pr√©sente des caract√©ristiques de plusieurs patterns.";
                        profileDesc = "Cette complexit√© est fr√©quente en pratique clinique. Une √©valuation professionnelle permettrait de clarifier le tableau clinique et de prioriser les interventions.";
                    }
                }

                DOM.profileTitle.textContent = profileTitle;
                DOM.profileText.textContent = profileText;
                DOM.profileDescription.textContent = profileDesc;
                
                DOM.confidenceBadge.className = `confidence-badge ${confidence}`;
                DOM.confidenceBadge.textContent = confidence === 'high' ? 'Orientation claire' : 
                                                   confidence === 'medium' ? 'Orientation probable' : 'Orientation incertaine';
            }

            /**
             * G√©n√®re les notes cliniques
             * @param {Object} scores - Scores calcul√©s
             */
            function generateClinicalNotes(scores) {
                const warnings = [];
                
                if (scores.bip >= THRESHOLDS.HIGH) {
                    warnings.push("Score BiP significatif : Un traitement antid√©presseur ISRS seul pourrait pr√©senter un risque de virage maniaque ou d'acc√©l√©ration des cycles. Une √©valuation sp√©cialis√©e est recommand√©e avant toute prescription.");
                }
                
                if (scores.bpd >= THRESHOLDS.HIGH && scores.dep >= THRESHOLDS.BPD_COMBINED) {
                    warnings.push("La d√©pression dans un contexte de traits BPD r√©pond souvent mieux √† une psychoth√©rapie sp√©cialis√©e (DBT, MBT, TFP) qu'aux antid√©presseurs seuls.");
                }
                
                if (scores.dep >= THRESHOLDS.DEPRESSION_SEVERE && scores.bip < THRESHOLDS.BIP_EXCLUDE) {
                    warnings.push("Score d√©pressif √©lev√© sans composante cyclique apparente : un traitement antid√©presseur classique pourrait √™tre appropri√©, √† √©valuer avec un professionnel.");
                }

                // V√©rifier les questions avec drapeaux
                const selfharmQ = questions.find(q => q.flag === FLAGS.SELFHARM);
                if (selfharmQ && state.answers[selfharmQ.id] >= 2) {
                    warnings.push("Vous avez mentionn√© des comportements d'automutilation. Si cela persiste ou s'intensifie, il est important d'en parler √† un professionnel de sant√©. Des techniques alternatives de r√©gulation √©motionnelle peuvent √™tre apprises en th√©rapie.");
                }

                const hopelessQ = questions.find(q => q.flag === FLAGS.HOPELESSNESS);
                if (hopelessQ && state.answers[hopelessQ.id] >= 3) {
                    warnings.push("Vous avez indiqu√© des pens√©es sombres fr√©quentes. Si ces pens√©es deviennent envahissantes ou si vous pensez √† vous faire du mal, contactez le 3114 (num√©ro national de pr√©vention du suicide) ou rendez-vous aux urgences.");
                }

                if (warnings.length === 0) {
                    DOM.clinicalNotes.classList.add('hidden');
                } else {
                    DOM.clinicalNotes.classList.remove('hidden');
                    DOM.clinicalList.innerHTML = warnings.map(w => {
                        const li = document.createElement('li');
                        li.textContent = w;
                        return li.outerHTML;
                    }).join('');
                }
            }

            /**
             * G√©n√®re les ressources recommand√©es
             * @param {Object} scores - Scores calcul√©s
             */
            function generateResources(scores) {
                const resources = [];
                
                if (scores.bip >= THRESHOLDS.BIP_COMBINED) {
                    resources.push("‚Üí Association Argos 2001 ‚Äî Troubles bipolaires");
                    resources.push("‚Üí FondaMental ‚Äî Fondation de recherche en psychiatrie");
                }
                
                if (scores.bpd >= THRESHOLDS.BPD_COMBINED) {
                    resources.push("‚Üí AAPEL ‚Äî Association d'aide aux personnes avec un trouble borderline");
                }
                
                if (scores.dep >= THRESHOLDS.DEP_COMBINED) {
                    resources.push("‚Üí France D√©pression ‚Äî Association d'entraide");
                }

                resources.push("üìû 3114 ‚Äî Num√©ro national de pr√©vention du suicide (24h/24, gratuit)");

                DOM.resourcesCard.classList.remove('hidden');
                DOM.resourcesList.innerHTML = resources.map(text => {
                    const div = document.createElement('div');
                    div.className = 'resource-item';
                    div.setAttribute('role', 'listitem');
                    div.textContent = text;
                    return div.outerHTML;
                }).join('');
            }

            /**
             * Exporte les r√©sultats (impression)
             */
            function exportResults() {
                window.print();
            }

            /**
             * Recommence le questionnaire
             */
            function restartQuiz() {
                state.currentQuestion = 0;
                state.answers = {};
                state.shuffledQuestions = smartShuffleQuestions(questions);
                
                DOM.resultsContainer.style.display = 'none';
                DOM.quizContainer.classList.remove('hidden');
                DOM.validityWarning.classList.add('hidden');
                
                renderQuestion();
                window.scrollTo({ top: 0, behavior: 'smooth' });
                announce('Questionnaire recommenc√©. Question 1.');
            }

            // =====================
            // INITIALISATION
            // =====================

            /**
             * Initialise l'application
             */
            function init() {
                try {
                    // Initialiser le cache DOM
                    initDOMCache();

                    // Initialiser l'√©tat
                    state.shuffledQuestions = smartShuffleQuestions(questions);
                    DOM.totalQ.textContent = state.totalQuestions;
                    DOM.progressBar.setAttribute('aria-valuemax', state.totalQuestions);

                    // Attacher les √©v√©nements
                    DOM.prevBtn.addEventListener('click', prevQuestion);
                    DOM.nextBtn.addEventListener('click', nextQuestion);
                    DOM.exportBtn.addEventListener('click', exportResults);
                    DOM.restartBtn.addEventListener('click', restartQuiz);

                    // Gestion du clavier pour la navigation
                    document.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' && !DOM.nextBtn.disabled && document.activeElement.closest('.likert-option')) {
                            nextQuestion();
                        }
                    });

                    // Afficher la premi√®re question
                    renderQuestion();

                } catch (error) {
                    console.error('Erreur lors de l\'initialisation du questionnaire:', error);
                    document.body.innerHTML = '<div style="padding: 40px; text-align: center; color: #991b1b;"><h1>Erreur</h1><p>Impossible de charger le questionnaire. Veuillez rafra√Æchir la page.</p></div>';
                }
            }

            // Lancer l'application quand le DOM est pr√™t
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }

        })();
    </script>
</body>
</html>
