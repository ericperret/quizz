<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triage Pédiatrique</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        h1 { text-align: center; color: #2c3e50; }
        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        /* Mode switch */
        .mode-switch {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .mode-switch button {
            padding: 12px 30px;
            font-size: 1em;
            border: 2px solid #007bff;
            background: white;
            color: #007bff;
            cursor: pointer;
        }
        .mode-switch button:first-child { border-radius: 8px 0 0 8px; }
        .mode-switch button:last-child { border-radius: 0 8px 8px 0; border-left: none; }
        .mode-switch button.active { background: #007bff; color: white; }
        
        #mode-triage, #mode-reverse { display: none; }
        #mode-triage.active, #mode-reverse.active { display: block; }
        
        /* Catégories */
        .category {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .category h2 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 1.2em;
        }
        .symptom-item { margin: 10px 0; }
        .symptom-item > label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 500;
        }
        .symptom-item > label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        .sub-options {
            display: none;
            margin-left: 35px;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #007bff;
        }
        .sub-options.visible { display: block; }
        .sub-options label { display: block; margin: 5px 0; cursor: pointer; }
        .sub-options input[type="radio"],
        .sub-options input[type="checkbox"] { margin-right: 8px; }
        .red-flag { color: #dc3545; }
        .red-flag::after { content: " ⚠️"; }
        
        /* Boutons */
        button#analyser {
            display: block;
            width: 100%;
            padding: 15px 30px;
            font-size: 1.2em;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 20px 0;
        }
        button#reset {
            display: block;
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        /* Résultats */
        #resultat { display: none; padding: 25px; border-radius: 10px; margin-top: 20px; }
        #resultat.niveau-rouge { background: #f8d7da; border: 2px solid #dc3545; }
        #resultat.niveau-orange { background: #ffe5d0; border: 2px solid #fd7e14; }
        #resultat.niveau-jaune { background: #fff3cd; border: 2px solid #ffc107; }
        #resultat.niveau-vert { background: #d4edda; border: 2px solid #28a745; }
        #resultat h3 { margin-top: 0; display: flex; align-items: center; gap: 10px; }
        
        .pathologies-probables, .conseils, .surveillance {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
        }
        .pathologies-probables h4, .conseils h4, .surveillance h4 { margin-top: 0; }
        
        /* Carte pathologie avec critères */
        .patho-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .patho-card.top { border: 2px solid #007bff; background: #f0f7ff; }
        .patho-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .patho-score {
            background: #007bff;
            color: white;
            padding: 3px 12px;
            border-radius: 12px;
            font-weight: bold;
        }
        .patho-desc { font-size: 0.9em; color: #666; margin-bottom: 10px; }
        
        /* Critères colorés */
        .criteres-box { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .critere-tag {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            display: inline-block;
        }
        .critere-attendu { background: #d4edfc; color: #1a5276; }
        .critere-exclusion { background: #fadbd8; color: #922b21; }
        .critere-match { box-shadow: 0 0 0 3px #27ae60; }
        
        /* Mode référence */
        .maladie-select {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .maladie-detail {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .maladie-detail h3 { margin-top: 0; color: #2c3e50; font-size: 1.4em; }
        .maladie-section {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
        }
        .maladie-section h4 { margin: 0 0 10px 0; font-size: 1em; }
        .maladie-section ul { margin: 0; padding-left: 20px; }
        .section-symptomes { background: #e3f2fd; border-left: 4px solid #2196f3; }
        .section-absents { background: #fff3e0; border-left: 4px solid #ff9800; }
        .section-alertes { background: #ffebee; border-left: 4px solid #f44336; }
        .section-conseils { background: #e8f5e9; border-left: 4px solid #4caf50; }
        .section-niveau {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .niveau-vert { background: #d4edda; color: #155724; }
        .niveau-jaune { background: #fff3cd; color: #856404; }
        .niveau-orange { background: #ffe5d0; color: #8a4500; }
        .niveau-rouge { background: #f8d7da; color: #721c24; }
        
        .alerte-rouge {
            background: linear-gradient(135deg, #dc3545, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<h1>🏥 Triage Pédiatrique<br><small style="font-size:0.6em">Enfant 6-15 ans</small></h1>

<div class="disclaimer">
    <strong>⚠️ Cet outil ne remplace pas un avis médical.</strong><br>
    En cas d'urgence vitale, appelez le <strong>15</strong> ou le <strong>112</strong>.
</div>

<div class="mode-switch">
    <button class="active" onclick="switchMode('triage')">🔍 Triage</button>
    <button onclick="switchMode('reverse')">📚 Référence</button>
</div>

<div id="mode-triage" class="active">

    <div class="category">
        <h2>🌡️ État Général</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="fievre" onchange="toggleSub(this)"> Fièvre</label>
            <div class="sub-options" id="sub-fievre">
                <strong>Température :</strong><br>
                <label><input type="radio" name="temp" value="38"> 38 - 38.5°C</label>
                <label><input type="radio" name="temp" value="38.5"> 38.5 - 39°C</label>
                <label><input type="radio" name="temp" value="39"> 39 - 40°C</label>
                <label class="red-flag"><input type="radio" name="temp" value="40"> > 40°C</label>
                <hr>
                <strong>Durée :</strong><br>
                <label><input type="radio" name="fievre-duree" value="1-2j"> 1-2 jours</label>
                <label><input type="radio" name="fievre-duree" value="3-4j"> 3-4 jours</label>
                <label><input type="radio" name="fievre-duree" value="5j-plus"> ≥ 5 jours</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="fatigue" onchange="toggleSub(this)"> Fatigue inhabituelle</label>
            <div class="sub-options" id="sub-fatigue">
                <label><input type="radio" name="fatigue-level" value="legere"> Légère</label>
                <label><input type="radio" name="fatigue-level" value="marquee"> Marquée</label>
                <label class="red-flag"><input type="radio" name="fatigue-level" value="prostration"> Prostration</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="appetit"> Perte d'appétit</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="frissons"> Frissons / Sueurs</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="courbatures"> Courbatures intenses</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="douleur-yeux"> Douleur derrière les yeux</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="paleur" onchange="toggleSub(this)"> Pâleur / Teint anormal</label>
            <div class="sub-options" id="sub-paleur">
                <label><input type="radio" name="paleur-type" value="pale"> Pâle</label>
                <label><input type="radio" name="paleur-type" value="gris"> Teint gris</label>
                <label class="red-flag"><input type="radio" name="paleur-type" value="marbrures"> Marbrures</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurThorax"> Douleur thoracique</label>
        </div>
    </div>

    <div class="category" style="border-left: 4px solid #17a2b8;">
        <h2>📊 Constantes vitales (si mesurées)</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="hasSpo2" onchange="toggleSub(this)"> SpO2 (saturation)</label>
            <div class="sub-options" id="sub-hasSpo2">
                <label><input type="radio" name="spo2-val" value="95"> ≥ 95% (normale)</label>
                <label><input type="radio" name="spo2-val" value="92"> 92-94%</label>
                <label class="red-flag"><input type="radio" name="spo2-val" value="90"> < 92%</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="hasFc" onchange="toggleSub(this)"> Fréquence cardiaque</label>
            <div class="sub-options" id="sub-hasFc">
                <strong>Âge :</strong><br>
                <label><input type="radio" name="fc-age" value="6-8"> 6-8 ans (N: 70-110)</label>
                <label><input type="radio" name="fc-age" value="9-12"> 9-12 ans (N: 65-105)</label>
                <label><input type="radio" name="fc-age" value="13-15"> 13-15 ans (N: 60-100)</label>
                <hr>
                <label>FC mesurée : <input type="number" id="fc-value" min="40" max="220" style="width:80px"> bpm</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="hasFr" onchange="toggleSub(this)"> Fréquence respiratoire</label>
            <div class="sub-options" id="sub-hasFr">
                <strong>Âge :</strong><br>
                <label><input type="radio" name="fr-age" value="6-8"> 6-8 ans (N: 18-24)</label>
                <label><input type="radio" name="fr-age" value="9-12"> 9-12 ans (N: 16-22)</label>
                <label><input type="radio" name="fr-age" value="13-15"> 13-15 ans (N: 12-20)</label>
                <hr>
                <label>FR mesurée : <input type="number" id="fr-value" min="8" max="60" style="width:80px"> /min</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="hasTa" onchange="toggleSub(this)"> Tension artérielle</label>
            <div class="sub-options" id="sub-hasTa">
                <label>Systolique : <input type="number" id="ta-sys" min="60" max="200" style="width:80px"> mmHg</label>
                <label>Diastolique : <input type="number" id="ta-dia" min="30" max="120" style="width:80px"> mmHg</label>
                <p style="font-size:0.8em;color:#666;margin-top:5px">Normal 6-15 ans : 90-120 / 55-80</p>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="hasGlycemie" onchange="toggleSub(this)"> Glycémie capillaire</label>
            <div class="sub-options" id="sub-hasGlycemie">
                <label>Valeur : <input type="number" id="glycemie-val" min="0.2" max="6" step="0.1" style="width:80px"> g/L</label>
                <p style="font-size:0.8em;color:#666;margin-top:5px">Normal : 0.7-1.1 g/L • Hypo < 0.6 • Hyper > 1.26</p>
            </div>
        </div>
    </div>

    <div class="category">
        <h2>🫁 ORL / Respiratoire</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="toux" onchange="toggleSub(this)"> Toux</label>
            <div class="sub-options" id="sub-toux">
                <strong>Type :</strong><br>
                <label><input type="radio" name="toux-type" value="seche"> Sèche</label>
                <label><input type="radio" name="toux-type" value="grasse"> Grasse</label>
                <label><input type="radio" name="toux-type" value="aboyante"> Aboyante (rauque)</label>
                <label><input type="radio" name="toux-type" value="quinteuse"> Quinteuse</label>
                <label><input type="radio" name="toux-type" value="eternuements"> Éternuements</label>
                <hr>
                <strong>Durée :</strong><br>
                <label><input type="radio" name="toux-duree" value="recent"> Récente (&lt; 1 semaine)</label>
                <label><input type="radio" name="toux-duree" value="prolongee"> Prolongée (1-3 sem)</label>
                <label><input type="radio" name="toux-duree" value="chronique"> Chronique (&gt; 3 sem)</label>
                <hr>
                <strong>Si quinteuse :</strong><br>
                <label><input type="checkbox" name="toux-quinte" value="chantCoq"> Reprise inspiratoire (chant du coq)</label>
                <label><input type="checkbox" name="toux-quinte" value="vomissement"> Vomissements après quinte</label>
                <label><input type="checkbox" name="toux-quinte" value="cyanose"> Cyanose pendant quinte</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="nez" onchange="toggleSub(this)"> Nez qui coule</label>
            <div class="sub-options" id="sub-nez">
                <label><input type="radio" name="nez-type" value="clair"> Clair</label>
                <label><input type="radio" name="nez-type" value="jaune"> Jaune/vert épais</label>
                <label><input type="radio" name="nez-type" value="sang"> Avec sang</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="gorge" onchange="toggleSub(this)"> Mal de gorge</label>
            <div class="sub-options" id="sub-gorge">
                <label><input type="radio" name="gorge-type" value="douleur"> Douleur simple</label>
                <label><input type="radio" name="gorge-type" value="avaler"> Difficulté à avaler</label>
                <label class="red-flag"><input type="radio" name="gorge-type" value="bave"> Bave / impossible d'avaler</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="voix"> Voix enrouée / éteinte</label>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="respiration" onchange="toggleSub(this)"> Difficultés respiratoires</label>
            <div class="sub-options" id="sub-respiration">
                <label><input type="radio" name="respi-type" value="rapide"> Respiration rapide</label>
                <label><input type="radio" name="respi-type" value="sifflante"> Sifflements</label>
                <label class="red-flag"><input type="radio" name="respi-type" value="tirage"> Tirage (creuse sous côtes)</label>
                <label class="red-flag"><input type="radio" name="respi-type" value="cyanose"> Lèvres bleues</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="oreille" onchange="toggleSub(this)"> Douleur d'oreille</label>
            <div class="sub-options" id="sub-oreille">
                <label><input type="checkbox" id="oreilleEcoul"> Écoulement</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="anosmie"> Perte odorat / goût</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="difficulteParler"> Difficulté à parler / voix faible</label>
        </div>
    </div>

    <div class="category">
        <h2>🤢 Digestif</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="vomissements" onchange="toggleSub(this)"> Vomissements</label>
            <div class="sub-options" id="sub-vomissements">
                <strong>Type :</strong><br>
                <label><input type="radio" name="vomi-type" value="alimentaire"> Alimentaires</label>
                <label><input type="radio" name="vomi-type" value="bilieux"> Verdâtres (bilieux)</label>
                <label class="red-flag"><input type="radio" name="vomi-type" value="sang"> Avec sang</label>
                <hr>
                <strong>Fréquence :</strong><br>
                <label><input type="radio" name="vomi-freq" value="quelques"> Quelques épisodes</label>
                <label><input type="radio" name="vomi-freq" value="repetes"> Répétés</label>
                <label class="red-flag"><input type="radio" name="vomi-freq" value="incoercible"> Incoercibles</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="diarrhee" onchange="toggleSub(this)"> Diarrhée</label>
            <div class="sub-options" id="sub-diarrhee">
                <strong>Type :</strong><br>
                <label><input type="radio" name="diarrhee-type" value="liquide"> Liquide</label>
                <label><input type="radio" name="diarrhee-type" value="glaires"> Avec glaires</label>
                <label class="red-flag"><input type="radio" name="diarrhee-type" value="sang"> Avec sang</label>
                <hr>
                <strong>Couleur :</strong><br>
                <label><input type="radio" name="diarrhee-couleur" value="normale"> Normale</label>
                <label><input type="radio" name="diarrhee-couleur" value="pale"> Pâle/décolorée</label>
                <label class="red-flag"><input type="radio" name="diarrhee-couleur" value="sang"> Sanglante</label>
                <label class="red-flag"><input type="radio" name="diarrhee-couleur" value="noire"> Noire</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="nausees"> Nausées</label>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurAbdo" onchange="toggleSub(this)"> Douleur abdominale</label>
            <div class="sub-options" id="sub-douleurAbdo">
                <strong>Localisation :</strong><br>
                <label><input type="radio" name="abdo-loc" value="diffuse"> Diffuse</label>
                <label><input type="radio" name="abdo-loc" value="periombilicale"> Autour nombril</label>
                <label><input type="radio" name="abdo-loc" value="fid"> Bas-ventre droit</label>
                <label><input type="radio" name="abdo-loc" value="epigastre"> Estomac</label>
                <hr>
                <label><input type="checkbox" name="abdo-carac" value="constante"> Douleur constante</label>
                <label><input type="checkbox" name="abdo-carac" value="crampes"> Crampes</label>
                <label><input type="checkbox" name="abdo-carac" value="migration"> Migration de la douleur</label>
                <label class="red-flag"><input type="checkbox" name="abdo-carac" value="defense"> Ventre dur (défense)</label>
                <hr>
                <strong>Signes appendice :</strong><br>
                <label><input type="checkbox" name="abdo-append" value="blumberg"> Douleur au relâchement</label>
                <label><input type="checkbox" name="abdo-append" value="psoitis"> Douleur extension jambe</label>
                <label><input type="checkbox" name="abdo-append" value="rovsing"> Douleur côté opposé</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="constipation"> Constipation / Arrêt des gaz</label>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="deshydratation" onchange="toggleSub(this)"> Signes de déshydratation</label>
            <div class="sub-options" id="sub-deshydratation">
                <label><input type="checkbox" name="desh" value="soif"> Soif intense</label>
                <label><input type="checkbox" name="desh" value="bouche"> Bouche sèche</label>
                <label class="red-flag"><input type="checkbox" name="desh" value="pli"> Pli cutané persistant</label>
                <label class="red-flag"><input type="checkbox" name="desh" value="yeux"> Yeux creux</label>
                <label class="red-flag"><input type="checkbox" name="desh" value="pasurines"> Pas d'urines > 8h</label>
            </div>
        </div>
    </div>

    <div class="category">
        <h2>🔴 Cutané</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="eruption" onchange="toggleSub(this)"> Éruption cutanée</label>
            <div class="sub-options" id="sub-eruption">
                <strong>Type :</strong><br>
                <label><input type="radio" name="eruption-type" value="macules"> Taches rouges plates</label>
                <label><input type="radio" name="eruption-type" value="papules"> Boutons en relief</label>
                <label><input type="radio" name="eruption-type" value="vesicules"> Petites cloques (avec liquide)</label>
                <label><input type="radio" name="eruption-type" value="urticaire"> Plaques qui grattent</label>
                <label class="red-flag"><input type="radio" name="eruption-type" value="purpura"> Ne s'efface PAS à la pression</label>
                <hr>
                <strong>Localisation :</strong><br>
                <label><input type="checkbox" name="eruption-loc" value="visage"> Visage</label>
                <label><input type="checkbox" name="eruption-loc" value="tronc"> Tronc</label>
                <label><input type="checkbox" name="eruption-loc" value="membres"> Membres</label>
                <label><input type="checkbox" name="eruption-loc" value="palmoplantaire"> Paumes/plantes</label>
                <hr>
                <label><input type="checkbox" id="eruptionGratte"> Démangeaisons</label>
                <hr>
                <strong>Texture :</strong><br>
                <label><input type="checkbox" name="eruption-texture" value="rugueuse"> Rugueuse (papier de verre)</label>
                <label><input type="checkbox" name="eruption-texture" value="desquamation"> Peau qui pèle</label>
                <hr>
                <strong>Évolution :</strong><br>
                <label><input type="radio" name="eruption-evolution" value="centrifuge"> Du centre vers extérieur</label>
                <label><input type="radio" name="eruption-evolution" value="centripete"> De l'extérieur vers centre</label>
                <label><input type="radio" name="eruption-evolution" value="simultanee"> Apparition simultanée</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="aphtes"> Aphtes / lésions buccales</label>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="oedeme" onchange="toggleSub(this)"> Gonflement (œdème)</label>
            <div class="sub-options" id="sub-oedeme">
                <label><input type="radio" name="oedeme-loc" value="visage"> Visage</label>
                <label class="red-flag"><input type="radio" name="oedeme-loc" value="levres"> Lèvres/langue</label>
                <label><input type="radio" name="oedeme-loc" value="membres"> Membres</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="ictere"> Jaunisse (yeux/peau jaunes)</label>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="saignements" onchange="toggleSub(this)"> Saignements spontanés</label>
            <div class="sub-options" id="sub-saignements">
                <label><input type="checkbox" name="saign" value="nez"> Nez</label>
                <label><input type="checkbox" name="saign" value="gencives"> Gencives</label>
                <label><input type="checkbox" name="saign" value="ecchymoses"> Bleus spontanés</label>
            </div>
        </div>
    </div>

    <div class="category">
        <h2>🧠 Neurologique</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="cephalee" onchange="toggleSub(this)"> Maux de tête</label>
            <div class="sub-options" id="sub-cephalee">
                <label><input type="radio" name="cephalee-type" value="modere"> Modérés</label>
                <label><input type="radio" name="cephalee-type" value="intense"> Intenses</label>
                <label class="red-flag"><input type="radio" name="cephalee-type" value="brutal"> Brutal et intense ("pire de ma vie")</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label class="red-flag"><input type="checkbox" id="raideurNuque" onchange="toggleSub(this)"> Raideur de nuque</label>
            <div class="sub-options" id="sub-raideurNuque">
                <strong>Signes méningés spécifiques :</strong><br>
                <label class="red-flag"><input type="checkbox" id="kernig"> Signe de Kernig (douleur quand on tend la jambe, enfant couché)</label>
                <label class="red-flag"><input type="checkbox" id="brudzinski"> Signe de Brudzinski (jambes se plient quand on penche la tête)</label>
            </div>
        </div>
        <div class="symptom-item">
            <label class="red-flag"><input type="checkbox" id="convulsions"> Convulsions</label>
        </div>
        <div class="symptom-item">
            <label class="red-flag"><input type="checkbox" id="confusion"> Confusion / somnolence anormale</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="vertiges"> Vertiges</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="photophobie"> Gêne à la lumière</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="visionTrouble"> Vision trouble / double</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="paupieresTombantes"> Paupières tombantes</label>
        </div>
        <div class="symptom-item">
            <label class="red-flag"><input type="checkbox" id="faiblesseMusculaire"> Faiblesse musculaire</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="paresthesies"> Fourmillements / engourdissements</label>
        </div>
    </div>

    <div class="category">
        <h2>👁️ Autres signes</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="ganglions" onchange="toggleSub(this)"> Ganglions</label>
            <div class="sub-options" id="sub-ganglions">
                <label><input type="radio" name="ganglions-loc" value="cou"> Cou</label>
                <label><input type="radio" name="ganglions-loc" value="aisselles"> Aisselles</label>
                <label><input type="radio" name="ganglions-loc" value="aines"> Aines</label>
                <label><input type="radio" name="ganglions-loc" value="multiples"> Plusieurs zones</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="yeux" onchange="toggleSub(this)"> Problème aux yeux</label>
            <div class="sub-options" id="sub-yeux">
                <label><input type="checkbox" name="yeux-type" value="rouge"> Rouges</label>
                <label><input type="checkbox" name="yeux-type" value="colles"> Collés / sécrétions</label>
                <label><input type="checkbox" name="yeux-type" value="larmoie"> Larmoiement</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="langue" onchange="toggleSub(this)"> Aspect de la langue</label>
            <div class="sub-options" id="sub-langue">
                <label><input type="radio" name="langue-type" value="saburrale"> Blanche/chargée</label>
                <label><input type="radio" name="langue-type" value="framboise"> Rouge vif "framboisée"</label>
                <label><input type="radio" name="langue-type" value="seche"> Très sèche</label>
            </div>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="levresFissures"> Lèvres rouges, fissurées</label>
        </div>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurArticulaire" onchange="toggleSub(this)"> Douleurs articulaires</label>
            <div class="sub-options" id="sub-douleurArticulaire">
                <label><input type="radio" name="artic-intensite" value="legere"> Légères</label>
                <label><input type="radio" name="artic-intensite" value="moderee"> Modérées</label>
                <label><input type="radio" name="artic-intensite" value="intense"> Intenses</label>
            </div>
        </div>
    </div>

    <div class="category">
        <h2>💧 Urinaire</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="urinaire" onchange="toggleSub(this)"> Problèmes urinaires</label>
            <div class="sub-options" id="sub-urinaire">
                <label><input type="checkbox" name="urinaire-types" value="brulure"> Brûlures mictionnelles</label>
                <label><input type="checkbox" name="urinaire-types" value="frequent"> Envies fréquentes</label>
                <label><input type="checkbox" name="urinaire-types" value="urgence"> Urgences mictionnelles</label>
                <label class="red-flag"><input type="checkbox" name="urinaire-types" value="sang"> Sang dans urines</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="urinesCouleur" onchange="toggleSub(this)"> Urines anormales</label>
            <div class="sub-options" id="sub-urinesCouleur">
                <label><input type="radio" name="urines-couleur" value="fonce"> Foncées (thé)</label>
                <label><input type="radio" name="urines-couleur" value="trouble"> Troubles</label>
                <label class="red-flag"><input type="radio" name="urines-couleur" value="sang"> Sanglantes</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurLombaire"> Douleur lombaire (dos)</label>
        </div>
    </div>

    <div class="category">
        <h2>🦴 Ostéo-articulaire</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurMembre" onchange="toggleSub(this)"> Douleur membre</label>
            <div class="sub-options" id="sub-douleurMembre">
                <label><input type="checkbox" name="membre-signes" value="gonfle"> Gonflé</label>
                <label><input type="checkbox" name="membre-signes" value="rouge"> Rouge/chaud</label>
                <label><input type="checkbox" name="membre-signes" value="boiterie"> Boiterie</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurEpaule"> Douleur épaule</label>
        </div>
    </div>

    <div class="category">
        <h2>🩲 Génital (garçon)</h2>
        
        <div class="symptom-item">
            <label class="red-flag"><input type="checkbox" id="douleurTesticule" onchange="toggleSub(this)"> Douleur testiculaire</label>
            <div class="sub-options" id="sub-douleurTesticule">
                <strong>Début :</strong><br>
                <label class="red-flag"><input type="radio" name="testicule-debut" value="brutal"> Brutal</label>
                <label><input type="radio" name="testicule-debut" value="progressif"> Progressif</label>
                <hr>
                <label><input type="checkbox" name="testicule-signes" value="gonfle"> Gonflé</label>
                <label><input type="checkbox" name="testicule-signes" value="haut"> Remonté</label>
                <label><input type="checkbox" name="testicule-signes" value="rouge"> Rouge</label>
            </div>
        </div>
    </div>

    <div class="category">
        <h2>♀️ Gynécologique</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="douleurPelvienne" onchange="toggleSub(this)"> Douleur pelvienne</label>
            <div class="sub-options" id="sub-douleurPelvienne">
                <strong>Début :</strong><br>
                <label class="red-flag"><input type="radio" name="pelvien-debut" value="brutal"> Brutal</label>
                <label><input type="radio" name="pelvien-debut" value="progressif"> Progressif</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="metrorragies"> Saignements vaginaux anormaux</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="retardRegles"> Retard de règles</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="grossessePossible"> Grossesse possible</label>
        </div>
    </div>

    <div class="category" style="border-left: 4px solid #20c997;">
        <h2>🌍 Contexte / Terrain</h2>
        
        <div class="symptom-item">
            <label><input type="checkbox" id="repasSuspect"> Repas suspect < 48h</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="conserveMaison"> Conserve maison</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="collectivite"> Cas groupés (école, famille)</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="baignade"> Baignade rivière récente</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="drepanocytose"> Drépanocytose connue</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="asthme" onchange="toggleSub(this)"> Asthme connu</label>
            <div class="sub-options" id="sub-asthme">
                <strong>Déclencheurs récents :</strong><br>
                <label><input type="checkbox" name="asthme-trigger" value="effort"> Effort physique</label>
                <label><input type="checkbox" name="asthme-trigger" value="allergie"> Contact allergène (pollen, poussière, animal)</label>
                <label><input type="checkbox" name="asthme-trigger" value="infection"> Infection respiratoire</label>
                <label><input type="checkbox" name="asthme-trigger" value="froid"> Air froid</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="immunodepression"> Immunodéprimé</label>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="zonePalu" onchange="toggleSub(this)"> Séjour zone impaludée</label>
            <div class="sub-options" id="sub-zonePalu">
                <label><input type="radio" name="palu-zone" value="afrique"> Afrique</label>
                <label><input type="radio" name="palu-zone" value="asie"> Asie SE</label>
                <label><input type="radio" name="palu-zone" value="amazonie"> Amazonie</label>
            </div>
        </div>
        <div class="symptom-item">
            <label><input type="checkbox" id="vaccins" onchange="toggleSub(this)"> Statut vaccinal</label>
            <div class="sub-options" id="sub-vaccins">
                <label><input type="radio" name="vaccin-statut" value="ajour"> À jour</label>
                <label><input type="radio" name="vaccin-statut" value="incomplet"> Incomplet</label>
                <label><input type="radio" name="vaccin-statut" value="inconnu"> Inconnu</label>
            </div>
        </div>
    </div>

    <button id="analyser" onclick="analyser()">🔍 ANALYSER</button>
    <button id="reset" onclick="resetForm()">↶ Réinitialiser</button>
    
    <div id="resultat"></div>
</div>

<div id="mode-reverse">
    <select class="maladie-select" id="maladie-select" onchange="afficherMaladie()">
        <option value="">📚 Choisissez une pathologie</option>
    </select>
    <div id="maladie-detail"></div>
</div>




<script>



// ============================================
// MALADIES DB - RÉFÉRENTIEL BIJECTIF COMPLET
// 68 maladies avec mapping HTML
// ============================================

const maladiesDB = {

    // ============================================
    // ORL / RESPIRATOIRE
    // ============================================

    rhinopharyngite: {
        nom: "Rhinopharyngite (rhume)",
        description: "Infection virale bénigne des voies respiratoires supérieures. Très fréquente, guérit spontanément en 7-10 jours.",
        niveau: "vert",
        criteres: [
            { texte: "Nez qui coule", champ: "nez", op: "==", val: true },
            { texte: "Éternuements", champ: "touxType", op: "==", val: "eternuements" },
            { texte: "Toux légère", champ: "toux", op: "==", val: true },
            { texte: "Fièvre modérée (< 38.5°C)", champ: "temp", op: "<", val: 38.5 },
            { texte: "Mal de gorge léger", champ: "gorge", op: "==", val: true },
            { texte: "Mal de gorge léger", champ: "gorgeType", op: "==", val: "douleur" },
            { texte: "Légère fatigue", champ: "fatigue", op: "==", val: true },
            { texte: "Légère fatigue", champ: "fatigueLevel", op: "==", val: "legere" }
        ],
        exclusions: [
            { texte: "Fièvre élevée (> 39°C)", champ: "temp", op: ">=", val: 39 },
            { texte: "Difficultés respiratoires", champ: "respiration", op: "==", val: true },
            { texte: "Raideur de nuque", champ: "raideurNuque", op: "==", val: true },
            { texte: "Prostration", champ: "fatigueLevel", op: "==", val: "prostration" }
        ],
        urgence: null,
        alertes: [
            "Fièvre > 38.5°C persistant plus de 48-72h",
            "Douleur d'oreille (otite secondaire)",
            "Difficultés respiratoires",
            "Refus de boire"
        ],
        conseils: [
            "Hydratation régulière",
            "Lavage de nez au sérum physiologique",
            "Repos",
            "Paracétamol si fièvre ou inconfort"
        ],
        nonFaire: [
            "Antibiotiques (inefficaces contre les virus)"
        ]
    },

    angine: {
        nom: "Angine",
        description: "Infection des amygdales, virale (70-80%) ou bactérienne (streptocoque). Le test rapide (TROD) en pharmacie permet de différencier.",
        niveau: "jaune",
        criteres: [
            { texte: "Mal de gorge intense", champ: "gorge", op: "==", val: true },
            { texte: "Difficulté à avaler", champ: "gorgeType", op: "==", val: "avaler" },
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Fièvre (38-39°C)", champ: "temp", op: ">=", val: 38 },
            { texte: "Ganglions du cou", champ: "ganglions", op: "==", val: true },
            { texte: "Ganglions du cou", champ: "ganglionsLoc", op: "==", val: "cou" },
            { texte: "Perte d'appétit", champ: "appetit", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Nez qui coule", champ: "nez", op: "==", val: true },
            { texte: "Impossibilité d'avaler / bave", champ: "gorgeType", op: "==", val: "bave" }
        ],
        urgence: {
            condition: (data) => data.gorgeType === 'bave' && data.fievre,
            message: "Impossibilité de déglutir / bave - SUSPICION ÉPIGLOTTITE - URGENCE"
        },
        alertes: [
            "Impossibilité de déglutir / bave → épiglottite = URGENCE",
            "Difficultés respiratoires",
            "Gonflement du cou important",
            "Fièvre persistante malgré traitement"
        ],
        conseils: [
            "Test rapide streptocoque (TROD) en pharmacie",
            "Si TROD positif → consultation pour antibiotiques",
            "Paracétamol pour la douleur et fièvre",
            "Alimentation froide/tiède (moins douloureux)"
        ],
        nonFaire: [
            "Antibiotiques sans test positif"
        ]
    },

    otite: {
        nom: "Otite moyenne aiguë",
        description: "Infection de l'oreille moyenne, très fréquente chez l'enfant. Souvent complication d'un rhume.",
        niveau: "jaune",
        criteres: [
            { texte: "Douleur d'oreille", champ: "oreille", op: "==", val: true },
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Écoulement oreille", champ: "oreilleEcoul", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Raideur de nuque", champ: "raideurNuque", op: "==", val: true },
            { texte: "Éruption cutanée", champ: "eruption", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.oreille && data.raideurNuque,
            message: "Otite + raideur nuque - ÉLIMINER MASTOÏDITE/MÉNINGITE"
        },
        alertes: [
            "Gonflement/rougeur derrière l'oreille (mastoïdite)",
            "Fièvre très élevée persistante",
            "Troubles de l'équilibre importants",
            "Paralysie du visage"
        ],
        conseils: [
            "Consultation médicale recommandée",
            "Paracétamol pour la douleur",
            "Position semi-assise pour dormir",
            "Ne pas mettre d'eau dans l'oreille"
        ],
        nonFaire: [
            "Mettre des gouttes sans avis médical (si tympan perforé)"
        ]
    },

    laryngite: {
        nom: "Laryngite",
        description: "Inflammation du larynx avec œdème. Toux caractéristique 'aboyante'. Souvent nocturne.",
        niveau: "orange",
        criteres: [
            { texte: "Toux aboyante", champ: "touxType", op: "==", val: "aboyante" },
            { texte: "Voix enrouée/éteinte", champ: "voix", op: "==", val: true },
            { texte: "Difficultés respiratoires", champ: "respiration", op: "==", val: true },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Rhume préalable", champ: "nez", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Bave / impossibilité d'avaler", champ: "gorgeType", op: "==", val: "bave" },
            { texte: "Fièvre très élevée", champ: "temp", op: ">=", val: 39.5 }
        ],
        urgence: {
            condition: (data) => data.touxType === 'aboyante' && (data.respiType === 'tirage' || data.respiType === 'cyanose'),
            message: "Laryngite sévère avec tirage/cyanose - URGENCE RESPIRATOIRE"
        },
        alertes: [
            "Difficultés respiratoires marquées",
            "Tirage (creuse sous les côtes)",
            "Cyanose (lèvres bleues)",
            "Enfant qui bave, ne peut pas avaler → URGENCE (épiglottite)",
            "Agitation ou prostration"
        ],
        conseils: [
            "Calmer l'enfant (l'agitation aggrave)",
            "Air frais (ouvrir fenêtre, sortir quelques minutes)",
            "Air humide (salle de bain avec eau chaude)",
            "Position assise ou semi-assise",
            "Consulter si difficultés respiratoires"
        ],
        nonFaire: [
            "Allonger l'enfant à plat",
            "Paniquer (ça aggrave)"
        ]
    },

    bronchite: {
        nom: "Bronchite",
        description: "Inflammation des bronches, le plus souvent virale. Guérit spontanément en 2-3 semaines.",
        niveau: "jaune",
        criteres: [
            { texte: "Toux grasse", champ: "touxType", op: "==", val: "grasse" },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Fatigue", champ: "fatigue", op: "==", val: true },
            { texte: "Sifflements respiratoires", champ: "respiType", op: "==", val: "sifflante" }
        ],
        exclusions: [
            { texte: "Fièvre très élevée persistante", champ: "temp", op: ">=", val: 39 },
            { texte: "Difficultés respiratoires marquées", champ: "respiType", op: "==", val: "tirage" }
        ],
        urgence: null,
        alertes: [
            "Fièvre > 39°C persistant > 48h",
            "Difficultés respiratoires",
            "Douleur thoracique au repos",
            "Crachats sanglants"
        ],
        conseils: [
            "Hydratation +++",
            "Repos",
            "Paracétamol si fièvre",
            "Humidifier l'air ambiant"
        ],
        nonFaire: [
            "Antibiotiques (inefficaces si viral)",
            "Antitussifs si toux grasse (la toux évacue les sécrétions)"
        ]
    },

    crise_asthme: {
        nom: "Crise d'asthme",
        description: "Obstruction bronchique réversible. Fréquente chez l'enfant. Peut être grave si non traitée.",
        niveau: "orange",
        criteres: [
            { texte: "Asthme connu", champ: "asthme", op: "==", val: true },
            { texte: "Sifflements respiratoires", champ: "respiType", op: "==", val: "sifflante" },
            { texte: "Difficultés respiratoires", champ: "respiration", op: "==", val: true },
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Déclencheur identifié", champ: "asthmeTriggers", op: "!=", val: [] }
        ],
        exclusions: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 }
        ],
        urgence: {
            condition: (data) => data.asthme && (data.respiType === 'tirage' || data.respiType === 'cyanose' || data.difficulteParler),
            message: "CRISE D'ASTHME SÉVÈRE - SAMU 15 - Salbutamol + corticoïdes"
        },
        alertes: [
            "Difficulté à parler (phrases courtes)",
            "Tirage intercostal",
            "Cyanose (lèvres bleues)",
            "SpO2 < 92%",
            "Pas d'amélioration après bronchodilatateur",
            "Agitation ou prostration"
        ],
        conseils: [
            "Bronchodilatateur (Ventoline) : 2-4 bouffées avec chambre d'inhalation",
            "Position assise",
            "Calmer l'enfant",
            "Si pas d'amélioration en 20 min → Urgences",
            "Consulter médecin dans les 48h après crise"
        ],
        nonFaire: [
            "Allonger l'enfant",
            "Donner des sédatifs",
            "Retarder le traitement"
        ]
    },

    pneumonie: {
        nom: "Pneumonie",
        description: "Infection du poumon, bactérienne ou virale. Nécessite une évaluation médicale et souvent des antibiotiques.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre élevée (> 39°C)", champ: "temp", op: ">=", val: 39 },
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Respiration rapide", champ: "respiType", op: "==", val: "rapide" },
            { texte: "Difficultés respiratoires", champ: "respiration", op: "==", val: true },
            { texte: "Fatigue marquée", champ: "fatigueLevel", op: "in", val: ["marquee", "prostration"] },
            { texte: "Frissons", champ: "frissons", op: "==", val: true },
            { texte: "Douleur thoracique", champ: "douleurThorax", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.temp >= 40 && (data.respiType === 'tirage' || data.respiType === 'cyanose'),
            message: "Pneumonie sévère - Hospitalisation urgente"
        },
        alertes: [
            "Difficultés respiratoires importantes",
            "Cyanose (lèvres/ongles bleus)",
            "SpO2 < 94%",
            "Prostration",
            "Refus de boire"
        ],
        conseils: [
            "Consultation médicale nécessaire",
            "Radio pulmonaire souvent indiquée",
            "Antibiotiques si bactérienne",
            "Surveillance étroite"
        ],
        nonFaire: []
    },

    grippe: {
        nom: "Grippe (Influenza)",
        description: "Infection virale saisonnière. Début brutal avec fièvre élevée et courbatures intenses.",
        niveau: "jaune",
        criteres: [
            { texte: "Fièvre élevée brutale (> 39°C)", champ: "temp", op: ">=", val: 39 },
            { texte: "Frissons intenses", champ: "frissons", op: "==", val: true },
            { texte: "Courbatures intenses", champ: "courbatures", op: "==", val: true },
            { texte: "Maux de tête", champ: "cephalee", op: "==", val: true },
            { texte: "Fatigue intense", champ: "fatigueLevel", op: "in", val: ["marquee", "prostration"] },
            { texte: "Toux sèche", champ: "touxType", op: "==", val: "seche" },
            { texte: "Mal de gorge", champ: "gorge", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Douleur rétro-orbitaire", champ: "douleurYeux", op: "==", val: true },
            { texte: "Éruption cutanée", champ: "eruption", op: "==", val: true }
        ],
        urgence: null,
        alertes: [
            "Difficultés respiratoires",
            "Douleur thoracique",
            "Confusion",
            "Fièvre persistante > 5 jours"
        ],
        conseils: [
            "Repos au lit",
            "Hydratation abondante",
            "Paracétamol pour fièvre et douleurs",
            "Isolement pour éviter contagion"
        ],
        nonFaire: [
            "Aspirine chez l'enfant (syndrome de Reye)"
        ]
    },

    covid: {
        nom: "COVID-19",
        description: "Infection respiratoire par SARS-CoV-2. Formes généralement bénignes chez l'enfant mais surveillance nécessaire.",
        niveau: "jaune",
        criteres: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Fatigue", champ: "fatigue", op: "==", val: true },
            { texte: "Perte d'odorat/goût", champ: "anosmie", op: "==", val: true },
            { texte: "Maux de tête", champ: "cephalee", op: "==", val: true },
            { texte: "Courbatures", champ: "courbatures", op: "==", val: true },
            { texte: "Mal de gorge", champ: "gorge", op: "==", val: true },
            { texte: "Diarrhée", champ: "diarrhee", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Douleur rétro-orbitaire", champ: "douleurYeux", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.respiration && data.spo2Val === '90',
            message: "COVID avec désaturation - Hospitalisation"
        },
        alertes: [
            "Difficultés respiratoires",
            "Douleur thoracique",
            "Confusion",
            "Éruption cutanée + fièvre persistante (MIS-C)"
        ],
        conseils: [
            "Test de dépistage",
            "Isolement",
            "Repos et hydratation",
            "Paracétamol si fièvre"
        ],
        nonFaire: []
    },

    coqueluche: {
        nom: "Coqueluche",
        description: "Infection bactérienne respiratoire très contagieuse. Toux quinteuse caractéristique pendant plusieurs semaines.",
        niveau: "orange",
        criteres: [
            { texte: "Toux en quintes", champ: "touxType", op: "==", val: "quinteuse" },
            { texte: "Chant du coq", champ: "touxQuinte", op: "contains", val: "chant" },
            { texte: "Vomissements déclenchés par toux", champ: "touxQuinte", op: "contains", val: "vomit" },
            { texte: "Toux > 2 semaines", champ: "touxDuree", op: "==", val: "plus2sem" },
            { texte: "Vaccins incomplets", champ: "vaccinStatut", op: "in", val: ["incomplet", "inconnu"] }
        ],
        exclusions: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 }
        ],
        urgence: {
            condition: (data) => data.touxQuinte && data.touxQuinte.includes('cyanose'),
            message: "Cyanose pendant quintes - COQUELUCHE MALIGNE - URGENCE"
        },
        alertes: [
            "Cyanose (bleu) pendant les quintes",
            "Apnées",
            "Difficultés alimentaires",
            "Épuisement"
        ],
        conseils: [
            "Consultation pour confirmation (PCR)",
            "Antibiotiques (azithromycine) réduisent la contagiosité",
            "Éviction scolaire 5 jours après début antibiotiques",
            "Vérifier vaccination entourage"
        ],
        nonFaire: [
            "Antitussifs (inefficaces)",
            "Envoyer à l'école sans traitement"
        ]
    },

    // ============================================
    // DIGESTIF
    // ============================================

    gastro: {
        nom: "Gastro-entérite",
        description: "Infection digestive virale ou bactérienne. Très contagieuse. Guérit en 2-5 jours.",
        niveau: "jaune",
        criteres: [
            { texte: "Vomissements", champ: "vomissements", op: "==", val: true },
            { texte: "Diarrhée liquide", champ: "diarrhee", op: "==", val: true },
            { texte: "Diarrhée liquide", champ: "diarrheeType", op: "==", val: "liquide" },
            { texte: "Douleurs abdominales crampes", champ: "douleurAbdo", op: "==", val: true },
            { texte: "Douleurs abdominales crampes", champ: "abdoCarac", op: "contains", val: "crampes" },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Nausées", champ: "nausees", op: "==", val: true },
            { texte: "Perte d'appétit", champ: "appetit", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Sang dans selles", champ: "diarrheeCouleur", op: "in", val: ["sang", "noire"] },
            { texte: "Douleur localisée en bas à droite", champ: "abdoLoc", op: "==", val: "fid" }
        ],
        urgence: {
            condition: (data) => data.deshydratation && data.deshSignes && data.deshSignes.length >= 3,
            message: "Déshydratation sévère - Réhydratation urgente"
        },
        alertes: [
            "Signes de déshydratation (pli cutané, yeux creux, pas d'urines > 8h)",
            "Vomissements incoercibles (ne garde rien)",
            "Sang dans les selles ou vomissements",
            "Douleur abdominale qui se localise",
            "Fièvre élevée persistante"
        ],
        conseils: [
            "Réhydratation +++ (SRO en pharmacie)",
            "Petites quantités fréquentes",
            "Reprendre alimentation progressive",
            "Hygiène des mains stricte"
        ],
        nonFaire: [
            "Boissons sucrées type soda (aggrave diarrhée)",
            "Anti-diarrhéiques sans avis médical"
        ]
    },

    tiac: {
        nom: "Toxi-infection alimentaire (TIAC)",
        description: "Intoxication par aliments contaminés. Début 6-48h après ingestion.",
        niveau: "orange",
        criteres: [
            { texte: "Vomissements", champ: "vomissements", op: "==", val: true },
            { texte: "Diarrhée", champ: "diarrhee", op: "==", val: true },
            { texte: "Douleurs abdominales intenses", champ: "douleurAbdo", op: "==", val: true },
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Repas suspect", champ: "repasSuspect", op: "==", val: true },
            { texte: "Cas groupés", champ: "collectivite", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Symptômes neurologiques", champ: "visionTrouble", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.visionTrouble && data.faiblesseMusculaire,
            message: "Signes neurologiques - SUSPICION BOTULISME - URGENCE"
        },
        alertes: [
            "Déshydratation sévère",
            "Sang abondant dans les selles",
            "Fièvre très élevée",
            "Signes neurologiques (vision trouble, faiblesse) → botulisme"
        ],
        conseils: [
            "Réhydratation prioritaire",
            "Conserver les restes alimentaires suspects",
            "Consultation médicale recommandée",
            "Signalement si cas groupés"
        ],
        nonFaire: [
            "Anti-diarrhéiques (retiennent les toxines)"
        ]
    },

    appendicite: {
        nom: "Appendicite",
        description: "Inflammation de l'appendice. Urgence chirurgicale. Le diagnostic précoce est crucial.",
        niveau: "orange",
        criteres: [
            { texte: "Douleur FID", champ: "abdoLoc", op: "==", val: "fid" },
            { texte: "Migration douleur", champ: "abdoCarac", op: "contains", val: "migration" },
            { texte: "Douleur qui augmente", champ: "abdoCarac", op: "contains", val: "augmente" },
            { texte: "Vomissements APRÈS la douleur", champ: "abdoAppend", op: "contains", val: "vomi-apres" },
            { texte: "Perte d'appétit", champ: "abdoAppend", op: "contains", val: "anorexie" },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Marche courbé", champ: "abdoAppend", op: "contains", val: "marche" },
            { texte: "Position chien de fusil", champ: "abdoAppend", op: "contains", val: "couche" }
        ],
        exclusions: [
            { texte: "Diarrhée importante", champ: "diarrheeType", op: "==", val: "explosive" }
        ],
        urgence: {
            condition: (data) => data.abdoLoc === 'fid' && data.abdoCarac && data.abdoCarac.includes('defense'),
            message: "Appendicite avec défense - Chirurgie urgente"
        },
        alertes: [
            "Ventre dur (défense abdominale)",
            "Douleur au relâchement (rebond)",
            "Fièvre qui augmente",
            "Aggravation rapide"
        ],
        conseils: [
            "Consultation urgente nécessaire",
            "NE PAS faire manger ni boire",
            "NE PAS donner de laxatifs",
            "NE PAS appliquer de chaleur sur le ventre"
        ],
        nonFaire: [
            "Attendre en cas de doute",
            "Donner à manger ou à boire",
            "Laxatifs",
            "Chaleur sur le ventre"
        ]
    },

    occlusion: {
        nom: "Occlusion intestinale",
        description: "Arrêt du transit intestinal. Urgence chirurgicale.",
        niveau: "rouge",
        criteres: [
            { texte: "Douleurs abdominales intenses", champ: "douleurAbdo", op: "==", val: true },
            { texte: "Vomissements bilieux", champ: "vomiType", op: "==", val: "bilieux" },
            { texte: "Vomissements répétés", champ: "vomiFreq", op: "in", val: ["repete", "incoercible"] },
            { texte: "Arrêt selles et gaz", champ: "constipation", op: "==", val: true },
            { texte: "Ventre ballonné", champ: "abdoCarac", op: "contains", val: "ballonne" }
        ],
        exclusions: [
            { texte: "Diarrhée", champ: "diarrhee", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.vomiType === 'bilieux' && data.constipation,
            message: "Vomissements bilieux + arrêt transit - OCCLUSION - Chirurgie urgente"
        },
        alertes: [
            "Tous les symptômes ci-dessus constituent une urgence"
        ],
        conseils: [
            "Urgences immédiatement",
            "NE RIEN donner à manger ni à boire"
        ],
        nonFaire: [
            "Attendre",
            "Alimentation ou boisson",
            "Laxatifs"
        ]
    },

    hepatite: {
        nom: "Hépatite virale",
        description: "Infection du foie. Peut être asymptomatique ou sévère.",
        niveau: "orange",
        criteres: [
            { texte: "Jaunisse (ictère)", champ: "ictere", op: "==", val: true },
            { texte: "Fatigue intense", champ: "fatigueLevel", op: "in", val: ["marquee", "prostration"] },
            { texte: "Perte d'appétit", champ: "appetit", op: "==", val: true },
            { texte: "Nausées", champ: "nausees", op: "==", val: true },
            { texte: "Douleur sous côtes droites", champ: "abdoLoc", op: "==", val: "hcd" },
            { texte: "Urines foncées", champ: "urinesCouleur", op: "==", val: "fonce" },
            { texte: "Selles décolorées", champ: "diarrheeCouleur", op: "==", val: "pale" }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.ictere && data.confusion,
            message: "Ictère + confusion - HÉPATITE FULMINANTE - Urgence vitale"
        },
        alertes: [
            "Confusion (encéphalopathie hépatique)",
            "Saignements spontanés",
            "Jaunisse intense d'aggravation rapide"
        ],
        conseils: [
            "Consultation médicale nécessaire",
            "Repos strict",
            "Hygiène rigoureuse (hépatite A très contagieuse)",
            "Éviter médicaments hépatotoxiques"
        ],
        nonFaire: [
            "Paracétamol à fortes doses (hépatotoxique)",
            "Alcool"
        ]
    },

    invagination: {
        nom: "Invagination intestinale aiguë",
        description: "Pénétration d'un segment intestinal dans le segment d'aval. Urgence chirurgicale ou réduction par lavement.",
        niveau: "orange",
        criteres: [
            { texte: "Crises douloureuses paroxystiques", champ: "abdoCarac", op: "contains", val: "crampes" },
            { texte: "Pâleur pendant crises", champ: "paleur", op: "==", val: true },
            { texte: "Vomissements", champ: "vomissements", op: "==", val: true },
            { texte: "Refus alimentaire", champ: "appetit", op: "==", val: true },
            { texte: "Selles gelée de groseille", champ: "diarrheeCouleur", op: "==", val: "sang" }
        ],
        exclusions: [
            { texte: "Fièvre au début", champ: "fievre", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.abdoCarac && data.abdoCarac.includes('crampes') && data.diarrheeCouleur === 'sang',
            message: "Crises + rectorragies - INVAGINATION - Échographie urgente"
        },
        alertes: [
            "Rectorragies = invagination évoluée",
            "Signes de choc = nécrose intestinale"
        ],
        conseils: [
            "Échographie abdominale urgente (image en cocarde)",
            "Lavement thérapeutique si < 24h et pas de complication",
            "Chirurgie si échec ou complication"
        ],
        nonFaire: [
            "Attendre les rectorragies pour évoquer le diagnostic"
        ]
    },

    volvulus: {
        nom: "Volvulus",
        description: "Torsion d'une anse intestinale. Occlusion + ischémie. Urgence chirurgicale absolue.",
        niveau: "rouge",
        criteres: [
            { texte: "Douleur abdominale brutale intense", champ: "douleurAbdo", op: "==", val: true },
            { texte: "Vomissements bilieux", champ: "vomiType", op: "==", val: "bilieux" },
            { texte: "Arrêt des matières/gaz", champ: "constipation", op: "==", val: true },
            { texte: "Ballonnement", champ: "abdoCarac", op: "contains", val: "ballonne" },
            { texte: "Défense", champ: "abdoCarac", op: "contains", val: "defense" }
        ],
        exclusions: [
            { texte: "Diarrhée", champ: "diarrhee", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.vomiType === 'bilieux' && data.constipation,
            message: "Vomissements bilieux + arrêt transit - VOLVULUS - Chirurgie immédiate"
        },
        alertes: [
            "Tous ces signes = chirurgie urgente",
            "Signes de choc = ischémie avancée"
        ],
        conseils: [
            "Chirurgie urgente",
            "Ne rien donner per os"
        ],
        nonFaire: [
            "Attendre",
            "Alimentation"
        ]
    },

    ischemie_mesenterique: {
        nom: "Ischémie mésentérique",
        description: "Nécrose intestinale par occlusion vasculaire. Rare en pédiatrie. Douleur disproportionnée vs examen.",
        niveau: "rouge",
        criteres: [
            { texte: "Douleur abdominale INTENSE", champ: "douleurAbdo", op: "==", val: true },
            { texte: "Douleur constante", champ: "abdoCarac", op: "contains", val: "constante" },
            { texte: "Prostration", champ: "fatigueLevel", op: "==", val: "prostration" },
            { texte: "Rectorragies", champ: "diarrheeCouleur", op: "in", val: ["sang", "noire"] },
            { texte: "Vomissements", champ: "vomissements", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Défense (au début)", champ: "abdoCarac", op: "contains", val: "defense" }
        ],
        urgence: {
            condition: (data) => data.douleurAbdo && data.fatigueLevel === 'prostration' && !data.fievre,
            message: "Douleur disproportionnée - ISCHÉMIE MÉSENTÉRIQUE - Chirurgie urgente"
        },
        alertes: [
            "Douleur disproportionnée = signe majeur",
            "Acidose lactique"
        ],
        conseils: [
            "Angioscanner mésentérique",
            "Chirurgie / radiologie interventionnelle",
            "Réanimation"
        ],
        nonFaire: [
            "Se fier au ventre souple pour éliminer le diagnostic"
        ]
    },

    pancreatite_aigue: {
        nom: "Pancréatite aiguë",
        description: "Inflammation aiguë du pancréas. Formes sévères avec nécrose = urgence.",
        niveau: "orange",
        criteres: [
            { texte: "Douleur épigastrique intense", champ: "abdoLoc", op: "==", val: "estomac" },
            { texte: "Douleur constante", champ: "abdoCarac", op: "contains", val: "constante" },
            { texte: "Vomissements persistants", champ: "vomiFreq", op: "==", val: "incoercible" },
            { texte: "Position antalgique", champ: "abdoAppend", op: "contains", val: "couche" },
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Ictère possible", champ: "ictere", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.abdoLoc === 'estomac' && data.vomiFreq === 'incoercible' && data.confusion,
            message: "Pancréatite avec confusion - Forme grave - Réanimation"
        },
        alertes: [
            "Défaillance d'organe (choc, IRA, SDRA)",
            "Nécrose pancréatique",
            "Surinfection"
        ],
        conseils: [
            "Lipase > 3N confirme le diagnostic",
            "Scanner si forme sévère",
            "Jeûne strict",
            "Réhydratation",
            "Antalgiques"
        ],
        nonFaire: [
            "Alimentation précoce si forme sévère"
        ]
    },

    // ============================================
    // CUTANÉ / ÉRUPTIF
    // ============================================

    varicelle: {
        nom: "Varicelle",
        description: "Infection virale très contagieuse. Bénigne chez l'enfant immunocompétent.",
        niveau: "vert",
        criteres: [
            { texte: "Éruption vésiculeuse", champ: "eruptionType", op: "==", val: "vesicules" },
            { texte: "Lésions d'âges différents", champ: "eruption", op: "==", val: true },
            { texte: "Démangeaisons intenses", champ: "eruptionGratte", op: "==", val: true },
            { texte: "Localisation tronc", champ: "eruptionLoc", op: "contains", val: "tronc" },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Fatigue", champ: "fatigue", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Localisation mains/pieds prédominante", champ: "eruptionLoc", op: "contains", val: "mains" },
            { texte: "Fièvre élevée persistante", champ: "temp", op: ">=", val: 39 }
        ],
        urgence: {
            condition: (data) => data.eruptionType === 'vesicules' && data.immunodepression,
            message: "Varicelle sur terrain immunodéprimé - Hospitalisation"
        },
        alertes: [
            "Surinfection des lésions (pus, rougeur étendue, fièvre)",
            "Difficultés respiratoires",
            "Troubles neurologiques",
            "Lésions dans les yeux"
        ],
        conseils: [
            "Éviction scolaire jusqu'à croûtes (environ 7 jours)",
            "Antihistaminique pour les démangeaisons",
            "Ongles courts et propres",
            "Bains courts à l'eau tiède",
            "Paracétamol si fièvre"
        ],
        nonFaire: [
            "Aspirine (syndrome de Reye)",
            "Ibuprofène (risque de complications cutanées)",
            "Gratter (cicatrices)"
        ]
    },

    pmb: {
        nom: "Syndrome pieds-mains-bouche",
        description: "Infection virale (Coxsackie). Très contagieuse. Bénigne. Guérit en 7-10 jours.",
        niveau: "vert",
        criteres: [
            { texte: "Vésicules mains", champ: "eruptionLoc", op: "contains", val: "mains" },
            { texte: "Vésicules pieds", champ: "eruptionLoc", op: "contains", val: "pieds" },
            { texte: "Aphtes bouche", champ: "aphtes", op: "==", val: true },
            { texte: "Éruption fesses", champ: "eruptionLoc", op: "contains", val: "fesses" },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Refus de manger", champ: "appetit", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Vésicules sur tronc", champ: "eruptionLoc", op: "contains", val: "tronc" }
        ],
        urgence: null,
        alertes: [
            "Déshydratation (refus de boire)",
            "Fièvre élevée persistante",
            "Signes neurologiques (rare)"
        ],
        conseils: [
            "Alimentation froide et liquide",
            "Éviter aliments acides ou salés",
            "Paracétamol",
            "Éviction de collectivité jusqu'à guérison des lésions"
        ],
        nonFaire: [
            "Forcer à manger"
        ]
    },

    urticaire: {
        nom: "Urticaire / Réaction allergique",
        description: "Réaction cutanée allergique ou non. Généralement bénigne mais surveiller signes de gravité.",
        niveau: "jaune",
        criteres: [
            { texte: "Plaques rouges en relief", champ: "eruptionType", op: "==", val: "urticaire" },
            { texte: "Démangeaisons intenses", champ: "eruptionGratte", op: "==", val: true },
            { texte: "Apparition rapide", champ: "eruption", op: "==", val: true },
            { texte: "Gonflement possible", champ: "oedeme", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Difficultés respiratoires", champ: "respiration", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.eruption && (data.respiration || data.oedemeLoc === 'levres'),
            message: "Urticaire + œdème/gêne respiratoire - ANAPHYLAXIE - Adrénaline"
        },
        alertes: [
            "Gonflement des lèvres/langue/gorge → URGENCE",
            "Difficultés respiratoires → URGENCE",
            "Malaise, chute de tension → URGENCE"
        ],
        conseils: [
            "Antihistaminique",
            "Identifier l'allergène si possible",
            "Consultation si récidive ou étendu"
        ],
        nonFaire: []
    },

    scarlatine: {
        nom: "Scarlatine",
        description: "Angine streptococcique avec éruption cutanée. Nécessite antibiotiques.",
        niveau: "jaune",
        criteres: [
            { texte: "Angine avec fièvre élevée", champ: "gorge", op: "==", val: true },
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Éruption granitée", champ: "eruptionTexture", op: "contains", val: "granite" },
            { texte: "Langue framboisée", champ: "langueType", op: "==", val: "framboise" },
            { texte: "Ganglions", champ: "ganglions", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Éruption vésiculeuse", champ: "eruptionType", op: "==", val: "vesicules" }
        ],
        urgence: null,
        alertes: [
            "Douleurs articulaires (RAA)",
            "Urines foncées / rares (glomérulonéphrite)"
        ],
        conseils: [
            "Consultation médicale nécessaire",
            "Antibiotiques indispensables (pénicilline/amoxicilline)",
            "Éviction scolaire 48h après début antibiotiques"
        ],
        nonFaire: []
    },

    roseole: {
        nom: "Roséole (Exanthème subit)",
        description: "Infection virale bénigne. Fièvre élevée 3-4 jours puis éruption à la chute de la fièvre.",
        niveau: "vert",
        criteres: [
            { texte: "Fièvre élevée (39-40°C) pendant 3-4 jours", champ: "temp", op: ">=", val: 39 },
            { texte: "État général conservé malgré fièvre", champ: "fatigueLevel", op: "!=", val: "prostration" },
            { texte: "Éruption APRÈS chute fièvre", champ: "eruptionEvolution", op: "==", val: "apres-fievre" },
            { texte: "Éruption tronc", champ: "eruptionLoc", op: "contains", val: "tronc" }
        ],
        exclusions: [
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Éruption pendant la fièvre", champ: "eruptionEvolution", op: "==", val: "avec-fievre" }
        ],
        urgence: null,
        alertes: [
            "Convulsions fébriles (assez fréquentes avec cette infection)"
        ],
        conseils: [
            "Antipyrétiques pendant la phase fébrile",
            "Pas de traitement spécifique",
            "Rassurer : bénin, guérison spontanée"
        ],
        nonFaire: []
    },

    rougeole: {
        nom: "Rougeole",
        description: "Infection virale très contagieuse. Complications possibles graves. Maladie à déclaration obligatoire.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Conjonctivite", champ: "yeuxTypes", op: "contains", val: "rouge" },
            { texte: "Rhinite", champ: "nez", op: "==", val: true },
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Éruption descendante", champ: "eruptionEvolution", op: "==", val: "descend" },
            { texte: "Vaccins incomplets", champ: "vaccinStatut", op: "in", val: ["incomplet", "inconnu"] }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.eruption && data.confusion,
            message: "Rougeole + troubles conscience - ENCÉPHALITE - Urgence"
        },
        alertes: [
            "Encéphalite (confusion, convulsions)",
            "Pneumonie",
            "Surinfection bactérienne"
        ],
        conseils: [
            "Isolement strict",
            "Déclaration obligatoire ARS",
            "Vérifier vaccination entourage",
            "Vitamine A (OMS)"
        ],
        nonFaire: [
            "Envoyer en collectivité"
        ]
    },

    // ============================================
    // ARBOVIROSES (TROPICAL)
    // ============================================

    dengue: {
        nom: "Dengue",
        description: "Arbovirose transmise par moustique (Aedes). Endémique aux Antilles. Surveillance J3-J7 cruciale.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre élevée brutale (> 39°C)", champ: "temp", op: ">=", val: 39 },
            { texte: "Douleur rétro-orbitaire", champ: "douleurYeux", op: "==", val: true },
            { texte: "Céphalées intenses", champ: "cephaleeType", op: "in", val: ["intense", "brutal"] },
            { texte: "Courbatures intenses", champ: "courbatures", op: "==", val: true },
            { texte: "Fatigue marquée", champ: "fatigueLevel", op: "in", val: ["marquee", "prostration"] },
            { texte: "Éruption cutanée J2-J5", champ: "eruption", op: "==", val: true },
            { texte: "Nausées", champ: "nausees", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux importante", champ: "toux", op: "==", val: true },
            { texte: "Douleurs articulaires prédominantes", champ: "articIntensite", op: "==", val: "intense" }
        ],
        urgence: {
            condition: (data) => data.saignements || (data.douleurAbdo && data.abdoLoc === 'estomac') || data.extremitesFroides,
            message: "Dengue avec signes d'alarme - Hospitalisation"
        },
        alertes: [
            "Douleur abdominale intense",
            "Vomissements persistants",
            "Saignements (gencives, nez, ecchymoses)",
            "Agitation ou léthargie",
            "Extrémités froides",
            "Chute brutale de la fièvre + malaise → dengue sévère"
        ],
        conseils: [
            "Paracétamol UNIQUEMENT",
            "Hydratation +++",
            "Repos",
            "Protection anti-moustiques (éviter transmission)",
            "Surveillance étroite J3-J7"
        ],
        nonFaire: [
            "Aspirine (risque hémorragique)",
            "Ibuprofène (risque hémorragique)",
            "AINS"
        ]
    },

    chikungunya: {
        nom: "Chikungunya",
        description: "Arbovirose transmise par moustique. Douleurs articulaires intenses et invalidantes.",
        niveau: "jaune",
        criteres: [
            { texte: "Fièvre élevée brutale", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Douleurs articulaires intenses", champ: "douleurArticulaire", op: "==", val: true },
            { texte: "Douleurs articulaires intenses", champ: "articIntensite", op: "==", val: "intense" },
            { texte: "Gonflements articulaires", champ: "membreSignes", op: "contains", val: "gonfle" },
            { texte: "Éruption cutanée", champ: "eruption", op: "==", val: true },
            { texte: "Céphalées", champ: "cephalee", op: "==", val: true },
            { texte: "Courbatures", champ: "courbatures", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Douleur rétro-orbitaire marquée", champ: "douleurYeux", op: "==", val: true }
        ],
        urgence: null,
        alertes: [
            "Signes neurologiques",
            "Déshydratation",
            "Formes sévères chez le petit enfant"
        ],
        conseils: [
            "Paracétamol UNIQUEMENT",
            "Hydratation",
            "Repos",
            "Protection anti-moustiques"
        ],
        nonFaire: [
            "Aspirine",
            "Ibuprofène",
            "AINS (à éviter initialement)"
        ]
    },

    leptospirose: {
        nom: "Leptospirose",
        description: "Infection bactérienne liée à l'eau/boue contaminée par urines de rongeurs. Fréquente après baignade en rivière.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 39 },
            { texte: "Céphalées intenses", champ: "cephaleeType", op: "==", val: "intense" },
            { texte: "Courbatures intenses (mollets++)", champ: "courbatures", op: "==", val: true },
            { texte: "Conjonctivite", champ: "yeuxTypes", op: "contains", val: "rouge" },
            { texte: "Jaunisse", champ: "ictere", op: "==", val: true },
            { texte: "Baignade rivière/mare", champ: "baignade", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.ictere && data.deshSignes && data.deshSignes.includes('pasurines'),
            message: "Leptospirose ictéro-hémorragique - Urgence vitale"
        },
        alertes: [
            "Jaunisse (atteinte hépatique)",
            "Oligurie (peu d'urines → atteinte rénale)",
            "Saignements",
            "Confusion"
        ],
        conseils: [
            "Consultation médicale rapide",
            "Antibiotiques nécessaires",
            "Signaler la baignade au médecin"
        ],
        nonFaire: []
    },

    paludisme: {
        nom: "Paludisme (accès palustre)",
        description: "Infection parasitaire (Plasmodium) transmise par moustique anophèle. Urgence diagnostique et thérapeutique.",
        niveau: "rouge",
        criteres: [
            { texte: "Séjour zone impaludée < 2 mois", champ: "zonePalu", op: "==", val: true },
            { texte: "Fièvre avec frissons intenses", champ: "fievre", op: "==", val: true },
            { texte: "Frissons intenses", champ: "frissons", op: "==", val: true },
            { texte: "Céphalées", champ: "cephalee", op: "==", val: true },
            { texte: "Courbatures", champ: "courbatures", op: "==", val: true },
            { texte: "Vomissements", champ: "vomissements", op: "==", val: true },
            { texte: "Diarrhée", champ: "diarrhee", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Éruption cutanée", champ: "eruption", op: "==", val: true },
            { texte: "Toux importante", champ: "toux", op: "==", val: true },
            { texte: "Douleur rétro-orbitaire", champ: "douleurYeux", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.zonePalu && data.fievre && (data.confusion || data.convulsions || data.fatigueLevel === 'prostration'),
            message: "PALUDISME GRAVE - Artésunate IV - Urgence vitale"
        },
        alertes: [
            "Confusion / troubles de conscience → PALUDISME GRAVE",
            "Convulsions → PALUDISME GRAVE",
            "Prostration → PALUDISME GRAVE",
            "Ictère",
            "Urines foncées / rares",
            "Saignements"
        ],
        conseils: [
            "Frottis-goutte épaisse EN URGENCE (résultat < 2h)",
            "Hospitalisation si P. falciparum",
            "Artésunate IV si forme grave",
            "Toute fièvre au retour de zone d'endémie = paludisme jusqu'à preuve du contraire"
        ],
        nonFaire: [
            "Attendre pour faire le diagnostic",
            "Traiter en ambulatoire sans certitude"
        ]
    },

    // ============================================
    // AUTRES INFECTIONS
    // ============================================

    mononucleose: {
        nom: "Mononucléose infectieuse",
        description: "Infection virale (EBV). 'Maladie du baiser'. Fatigue prolongée fréquente. Rate fragile.",
        niveau: "jaune",
        criteres: [
            { texte: "Fatigue intense et prolongée", champ: "fatigueLevel", op: "in", val: ["marquee", "prostration"] },
            { texte: "Ganglions gonflés multiples", champ: "ganglions", op: "==", val: true },
            { texte: "Ganglions gonflés multiples", champ: "ganglionsLoc", op: "==", val: "multiple" },
            { texte: "Angine", champ: "gorge", op: "==", val: true },
            { texte: "Fièvre prolongée", champ: "fievreDuree", op: "==", val: "5j-plus" },
            { texte: "Perte d'appétit", champ: "appetit", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Signes respiratoires importants", champ: "respiration", op: "==", val: true }
        ],
        urgence: null,
        alertes: [
            "Douleur brutale flanc gauche (rupture rate)",
            "Difficultés respiratoires (gros ganglions)",
            "Jaunisse"
        ],
        conseils: [
            "Repos +++",
            "PAS de sport de contact pendant 4-6 semaines (rate fragile)",
            "Paracétamol",
            "La fatigue peut durer plusieurs semaines"
        ],
        nonFaire: [
            "Sports de contact",
            "Ampicilline/amoxicilline (éruption quasi constante)"
        ]
    },

    cystite: {
        nom: "Cystite (infection urinaire basse)",
        description: "Infection de la vessie. Plus fréquente chez les filles. Sans fièvre (sinon = pyélonéphrite).",
        niveau: "jaune",
        criteres: [
            { texte: "Brûlures en urinant", champ: "urinaireTypes", op: "contains", val: "brulure" },
            { texte: "Envies fréquentes d'uriner", champ: "urinaireTypes", op: "contains", val: "frequent" },
            { texte: "Urines troubles", champ: "urinaireTypes", op: "contains", val: "trouble" },
            { texte: "Urines malodorantes", champ: "urinaireTypes", op: "contains", val: "odeur" }
        ],
        exclusions: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Douleur lombaire", champ: "douleurLombaire", op: "==", val: true }
        ],
        urgence: null,
        alertes: [
            "Apparition de fièvre",
            "Douleur lombaire",
            "Sang dans les urines abondant"
        ],
        conseils: [
            "Consultation médicale pour analyse d'urines",
            "Boire beaucoup",
            "Uriner fréquemment"
        ],
        nonFaire: [
            "Se retenir d'uriner"
        ]
    },

    pyelonephrite: {
        nom: "Pyélonéphrite",
        description: "Infection du rein. Plus grave que la cystite. Nécessite antibiotiques et parfois hospitalisation.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Douleur lombaire", champ: "douleurLombaire", op: "==", val: true },
            { texte: "Frissons", champ: "frissons", op: "==", val: true },
            { texte: "Signes urinaires", champ: "urinaire", op: "==", val: true },
            { texte: "Nausées/vomissements", champ: "nausees", op: "==", val: true },
            { texte: "Fatigue", champ: "fatigue", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.douleurLombaire && data.fievre && data.confusion,
            message: "Pyélonéphrite compliquée - Hospitalisation"
        },
        alertes: [
            "Fièvre très élevée persistante",
            "Vomissements empêchant traitement oral",
            "Altération état général"
        ],
        conseils: [
            "Consultation médicale urgente",
            "Antibiotiques indispensables",
            "Bilan sanguin et ECBU"
        ],
        nonFaire: []
    },

    herpangine: {
        nom: "Herpangine",
        description: "Infection virale proche du pieds-mains-bouche. Ulcérations uniquement dans la bouche/gorge.",
        niveau: "jaune",
        criteres: [
            { texte: "Vésicules/ulcérations gorge", champ: "aphtes", op: "==", val: true },
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 39 },
            { texte: "Mal de gorge intense", champ: "gorge", op: "==", val: true },
            { texte: "Refus de manger", champ: "appetit", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Éruption mains/pieds", champ: "eruptionLoc", op: "contains", val: "mains" }
        ],
        urgence: null,
        alertes: [
            "Déshydratation",
            "Fièvre persistante > 5 jours"
        ],
        conseils: [
            "Alimentation froide et liquide",
            "Paracétamol",
            "Éviter acide et salé"
        ],
        nonFaire: []
    },

    conjonctivite: {
        nom: "Conjonctivite",
        description: "Inflammation de la conjonctive. Virale, bactérienne ou allergique.",
        niveau: "vert",
        criteres: [
            { texte: "Œil rouge", champ: "yeuxTypes", op: "contains", val: "rouge" },
            { texte: "Larmoiement", champ: "yeuxTypes", op: "contains", val: "larmoie" },
            { texte: "Paupières collées", champ: "yeuxTypes", op: "contains", val: "colles" },
            { texte: "Yeux", champ: "yeux", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Douleur intense", champ: "cephaleeType", op: "==", val: "intense" },
            { texte: "Photophobie intense", champ: "photophobie", op: "==", val: true }
        ],
        urgence: null,
        alertes: [
            "Douleur oculaire intense",
            "Baisse de vision",
            "Atteinte d'un seul œil avec douleur",
            "Photophobie marquée"
        ],
        conseils: [
            "Nettoyage au sérum physiologique",
            "Consultation si purulent (possible collyre antibiotique)",
            "Lavage des mains fréquent",
            "Ne pas partager les linges"
        ],
        nonFaire: [
            "Mettre des collyres sans avis médical"
        ]
    },

    // ============================================
    // OPHTALMOLOGIQUES
    // ============================================

    herpes_oculaire: {
        nom: "Herpès oculaire (kératite herpétique)",
        description: "Infection de la cornée par HSV. URGENCE CÉCITANTE. Traitement antiviral < 24h impératif.",
        niveau: "rouge",
        criteres: [
            { texte: "Œil rouge unilatéral", champ: "yeuxTypes", op: "contains", val: "rouge" },
            { texte: "Photophobie intense", champ: "photophobie", op: "==", val: true },
            { texte: "Larmoiement", champ: "yeuxTypes", op: "contains", val: "larmoie" },
            { texte: "Vésicules visage", champ: "eruptionType", op: "==", val: "vesicules" },
            { texte: "Vésicules visage", champ: "eruptionLoc", op: "contains", val: "visage" }
        ],
        exclusions: [
            { texte: "Sécrétions purulentes", champ: "yeuxTypes", op: "contains", val: "colles" }
        ],
        urgence: {
            condition: (data) => data.yeux && data.photophobie && data.eruptionType === 'vesicules' && data.eruptionLoc && data.eruptionLoc.includes('visage'),
            message: "HERPÈS OCULAIRE - Ophtalmo < 24h - Risque cécité"
        },
        alertes: [
            "TOUTE suspicion = urgence ophtalmologique < 24h",
            "Baisse de vision = kératite profonde",
            "Récidives fréquentes"
        ],
        conseils: [
            "Consultation ophtalmologique URGENTE",
            "Aciclovir pommade ophtalmique ou Valaciclovir PO",
            "NE JAMAIS donner de corticoïdes locaux sans avis ophtalmo"
        ],
        nonFaire: [
            "Corticoïdes locaux (aggravation majeure)",
            "Attendre",
            "Traiter comme conjonctivite banale"
        ]
    },

    zona_ophtalmique: {
        nom: "Zona ophtalmique (V1)",
        description: "Réactivation VZV dans le territoire V1. Si atteinte du nez = atteinte oculaire quasi certaine.",
        niveau: "rouge",
        criteres: [
            { texte: "Éruption vésiculeuse hémifront", champ: "eruptionType", op: "==", val: "vesicules" },
            { texte: "Éruption visage", champ: "eruptionLoc", op: "contains", val: "visage" },
            { texte: "Céphalées", champ: "cephalee", op: "==", val: true },
            { texte: "Œil rouge", champ: "yeuxTypes", op: "contains", val: "rouge" },
            { texte: "Photophobie", champ: "photophobie", op: "==", val: true },
            { texte: "Œdème palpébral", champ: "oedeme", op: "==", val: true },
            { texte: "Œdème palpébral", champ: "oedemeLoc", op: "==", val: "oeil" }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.eruptionType === 'vesicules' && data.eruptionLoc && data.eruptionLoc.includes('visage') && data.yeux,
            message: "ZONA V1 - Valaciclovir < 72h - Ophtalmo urgent"
        },
        alertes: [
            "Signe de Hutchinson (nez) = atteinte oculaire quasi certaine",
            "Baisse de vision",
            "Uvéite, kératite, rétinite possibles"
        ],
        conseils: [
            "Valaciclovir 1g x3/j pendant 7 jours - DANS LES 72H du début",
            "Consultation ophtalmologique systématique si atteinte péri-oculaire",
            "Antalgiques (douleurs intenses)"
        ],
        nonFaire: [
            "Retarder le traitement antiviral",
            "Corticoïdes sans couverture antivirale"
        ]
    },

    cellulite_orbitaire: {
        nom: "Cellulite orbitaire",
        description: "Infection des tissus orbitaires. Complication de sinusite. Urgence vitale (extension cérébrale possible).",
        niveau: "rouge",
        criteres: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Œdème palpébral important", champ: "oedeme", op: "==", val: true },
            { texte: "Œdème palpébral important", champ: "oedemeLoc", op: "==", val: "oeil" },
            { texte: "Œil rouge", champ: "yeuxTypes", op: "contains", val: "rouge" }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.fievre && data.oedeme && data.oedemeLoc === 'oeil' && data.cephaleeType === 'intense',
            message: "CELLULITE ORBITAIRE - Scanner + ATB IV urgent"
        },
        alertes: [
            "Exophtalmie + ophtalmoplégie = cellulite orbitaire",
            "Troubles de conscience = extension intracrânienne",
            "Baisse de vision = compression nerf optique"
        ],
        conseils: [
            "Hospitalisation urgente",
            "Scanner orbites + crâne",
            "Antibiothérapie IV",
            "Avis ORL (drainage sinusien possible)"
        ],
        nonFaire: [
            "Traiter en ambulatoire",
            "Attendre l'évolution"
        ]
    },

    // ============================================
    // ORL / VOIES AÉRIENNES CRITIQUES
    // ============================================

    epiglottite: {
        nom: "Épiglottite",
        description: "Infection bactérienne de l'épiglotte. Obstruction rapide des voies aériennes. URGENCE VITALE.",
        niveau: "rouge",
        criteres: [
            { texte: "Fièvre élevée brutale", champ: "temp", op: ">=", val: 39 },
            { texte: "Hypersialorrhée (bave)", champ: "gorgeType", op: "==", val: "bave" },
            { texte: "Voix étouffée", champ: "voix", op: "==", val: true },
            { texte: "Dyspnée", champ: "respiration", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux aboyante", champ: "touxType", op: "==", val: "aboyante" }
        ],
        urgence: {
            condition: (data) => data.gorgeType === 'bave' && data.fievre && data.voix,
            message: "ÉPIGLOTTITE - SAMU - NE PAS examiner gorge - NE PAS allonger"
        },
        alertes: [
            "TOUS ces signes = URGENCE VITALE",
            "Risque d'obstruction complète brutale"
        ],
        conseils: [
            "APPELER LE 15 IMMÉDIATEMENT",
            "NE PAS examiner la gorge (risque de spasme laryngé fatal)",
            "NE PAS allonger l'enfant",
            "Laisser en position assise",
            "Intubation en conditions sécurisées au bloc"
        ],
        nonFaire: [
            "Examiner la gorge avec un abaisse-langue",
            "Allonger l'enfant",
            "Tenter de faire boire",
            "Retarder l'appel au SAMU"
        ]
    },

    abces_retropharynge: {
        nom: "Abcès rétropharyngé",
        description: "Collection purulente en arrière du pharynx. Risque d'obstruction et de médiastinite.",
        niveau: "rouge",
        criteres: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Dysphagie importante", champ: "gorgeType", op: "==", val: "avaler" },
            { texte: "Torticolis/raideur nuque", champ: "raideurNuque", op: "==", val: true },
            { texte: "Voix modifiée", champ: "voix", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Photophobie", champ: "photophobie", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.fievre && data.gorge && data.raideurNuque && !data.photophobie,
            message: "ABCÈS RÉTROPHARYNGÉ - Scanner cervical - ATB IV"
        },
        alertes: [
            "Dyspnée = compression voies aériennes",
            "Médiastinite si extension"
        ],
        conseils: [
            "Scanner cervical urgent",
            "Antibiothérapie IV",
            "Drainage chirurgical souvent nécessaire"
        ],
        nonFaire: [
            "Ponction à l'aveugle"
        ]
    },

    angine_ludwig: {
        nom: "Angine de Ludwig",
        description: "Cellulite du plancher buccal. Risque d'asphyxie par œdème laryngé. Souvent origine dentaire.",
        niveau: "rouge",
        criteres: [
            { texte: "Tuméfaction sous-mandibulaire", champ: "oedeme", op: "==", val: true },
            { texte: "Hypersialorrhée", champ: "gorgeType", op: "==", val: "bave" },
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Dyspnée", champ: "respiration", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.gorge && data.gorgeType === 'bave' && data.respiration,
            message: "ANGINE DE LUDWIG - Risque asphyxie - SAMU"
        },
        alertes: [
            "Dyspnée = obstruction imminente",
            "Extension cervicale rapide",
            "Médiastinite"
        ],
        conseils: [
            "Urgence vitale - SAMU",
            "Sécurisation voies aériennes prioritaire",
            "Antibiothérapie IV",
            "Drainage chirurgical"
        ],
        nonFaire: [
            "Attendre"
        ]
    },

    // ============================================
    // CARDIOVASCULAIRES
    // ============================================

    myocardite: {
        nom: "Myocardite",
        description: "Inflammation du muscle cardiaque, souvent post-virale. Peut évoluer vers insuffisance cardiaque ou troubles du rythme.",
        niveau: "orange",
        criteres: [
            { texte: "Fatigue intense post-virale", champ: "fatigueLevel", op: "in", val: ["marquee", "prostration"] },
            { texte: "Dyspnée d'effort puis repos", champ: "respiration", op: "==", val: true },
            { texte: "Dyspnée d'effort puis repos", champ: "respiType", op: "==", val: "rapide" },
            { texte: "Douleur thoracique", champ: "douleurThorax", op: "==", val: true },
            { texte: "Malaises", champ: "vertiges", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux productive", champ: "touxType", op: "==", val: "grasse" },
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 }
        ],
        urgence: {
            condition: (data) => data.fatigueLevel === 'prostration' && data.respiration && !data.toux && !data.fievre,
            message: "MYOCARDITE suspectée - ECG + Troponine urgent"
        },
        alertes: [
            "Syncope",
            "Dyspnée de repos",
            "Troubles du rythme",
            "Insuffisance cardiaque"
        ],
        conseils: [
            "ECG + Troponine + BNP",
            "Échographie cardiaque",
            "Hospitalisation si confirmé",
            "Repos strict +++ (risque mort subite à l'effort)"
        ],
        nonFaire: [
            "Sport pendant plusieurs mois",
            "Négliger une fatigue anormale post-virale"
        ]
    },

    pericardite: {
        nom: "Péricardite / Tamponnade",
        description: "Inflammation du péricarde. Si épanchement abondant = tamponnade = urgence vitale.",
        niveau: "orange",
        criteres: [
            { texte: "Douleur thoracique", champ: "douleurThorax", op: "==", val: true },
            { texte: "Fièvre modérée", champ: "fievre", op: "==", val: true },
            { texte: "Dyspnée", champ: "respiration", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.respiration && data.fatigueLevel === 'prostration' && data.extremitesFroides,
            message: "TAMPONNADE suspectée - Échographie urgente"
        },
        alertes: [
            "Tamponnade : dyspnée + turgescence jugulaire + hypotension + pouls paradoxal",
            "Choc cardiogénique"
        ],
        conseils: [
            "ECG (sus-décalage ST diffus, sous-décalage PR)",
            "Échographie cardiaque urgente",
            "AINS ou Colchicine si simple",
            "Drainage si tamponnade"
        ],
        nonFaire: []
    },

    endocardite: {
        nom: "Endocardite infectieuse",
        description: "Infection des valves cardiaques. Fièvre prolongée inexpliquée = évoquer systématiquement.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre prolongée > 5 jours", champ: "fievreDuree", op: "==", val: "5j-plus" },
            { texte: "Fatigue", champ: "fatigue", op: "==", val: true },
            { texte: "Ganglions", champ: "ganglions", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Rhinite", champ: "nez", op: "==", val: true },
            { texte: "Angine", champ: "gorge", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.fievreDuree === '5j-plus' && data.confusion,
            message: "Fièvre prolongée + confusion - ENDOCARDITE ? - Hémocultures"
        },
        alertes: [
            "Insuffisance cardiaque",
            "Emboles cérébraux (AVC)",
            "Emboles spléniques, rénaux"
        ],
        conseils: [
            "Hémocultures multiples AVANT antibiothérapie",
            "Échographie cardiaque (ETO si besoin)",
            "Antibiothérapie prolongée IV",
            "Avis cardio-chirurgical"
        ],
        nonFaire: [
            "Antibiothérapie avant hémocultures (sauf sepsis sévère)"
        ]
    },

    // ============================================
    // NEUROLOGIQUES
    // ============================================

    meningite: {
        nom: "Méningite",
        description: "Infection des méninges. URGENCE VITALE. Tout retard peut être fatal.",
        niveau: "rouge",
        criteres: [
            { texte: "Fièvre élevée", champ: "temp", op: ">=", val: 38.5 },
            { texte: "Céphalées intenses", champ: "cephaleeType", op: "in", val: ["intense", "brutal"] },
            { texte: "Raideur de nuque", champ: "raideurNuque", op: "==", val: true },
            { texte: "Signe de Kernig", champ: "kernig", op: "==", val: true },
            { texte: "Signe de Brudzinski", champ: "brudzinski", op: "==", val: true },
            { texte: "Photophobie", champ: "photophobie", op: "==", val: true },
            { texte: "Vomissements en jet", champ: "vomissements", op: "==", val: true },
            { texte: "Confusion/somnolence", champ: "confusion", op: "==", val: true },
            { texte: "Purpura", champ: "eruptionType", op: "==", val: "purpura" }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.raideurNuque && data.fievre && (data.confusion || data.eruptionType === 'purpura' || data.kernig || data.brudzinski),
            message: "MÉNINGITE - SAMU immédiat - Si purpura : C3G sur place"
        },
        alertes: [
            "TOUS ces symptômes sont des alertes",
            "Purpura = URGENCE ABSOLUE (appeler 15)",
            "Signes de Kernig/Brudzinski = haute spécificité"
        ],
        conseils: [
            "APPELER LE 15 IMMÉDIATEMENT",
            "Ne pas attendre"
        ],
        nonFaire: [
            "Attendre",
            "Essayer de traiter soi-même"
        ]
    },

    encephalite_herpes: {
        nom: "Encéphalite herpétique",
        description: "Infection cérébrale par HSV. Mortalité > 70% sans traitement. TRAITER AVANT CONFIRMATION.",
        niveau: "rouge",
        criteres: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true },
            { texte: "Confusion/troubles comportement", champ: "confusion", op: "==", val: true },
            { texte: "Convulsions", champ: "convulsions", op: "==", val: true },
            { texte: "Céphalées", champ: "cephaleeType", op: "in", val: ["intense", "brutal"] }
        ],
        exclusions: [
            { texte: "Raideur de nuque franche", champ: "raideurNuque", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.fievre && data.confusion && data.convulsions,
            message: "ENCÉPHALITE HERPÉTIQUE - Aciclovir IV AVANT résultats"
        },
        alertes: [
            "TOUS ces signes = URGENCE ABSOLUE",
            "Évolution rapide vers coma"
        ],
        conseils: [
            "Aciclovir IV IMMÉDIATEMENT - AVANT résultats",
            "PL + IRM + EEG",
            "Ne pas attendre confirmation pour traiter",
            "Réanimation souvent nécessaire"
        ],
        nonFaire: [
            "Attendre la PCR pour traiter",
            "Retarder l'aciclovir"
        ]
    },

    guillain_barre: {
        nom: "Syndrome de Guillain-Barré",
        description: "Polyradiculonévrite aiguë post-infectieuse. Paralysie ascendante. Risque de paralysie respiratoire.",
        niveau: "orange",
        criteres: [
            { texte: "Infection récente (1-4 sem avant)", champ: "diarrhee", op: "==", val: true },
            { texte: "Paresthésies extrémités", champ: "paresthesies", op: "==", val: true },
            { texte: "Faiblesse musculaire ascendante", champ: "faiblesseMusculaire", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.faiblesseMusculaire && data.respiration,
            message: "Guillain-Barré avec atteinte respiratoire - Réanimation"
        },
        alertes: [
            "Atteinte respiratoire (capacité vitale < 60%)",
            "Troubles de déglutition",
            "Dysautonomie (variations tension/pouls)"
        ],
        conseils: [
            "Hospitalisation systématique",
            "Surveillance capacité vitale répétée",
            "Immunoglobulines IV ou plasmaphérèse",
            "Réanimation si atteinte respiratoire"
        ],
        nonFaire: [
            "Corticoïdes (inefficaces)",
            "Traiter en ambulatoire"
        ]
    },

    htic: {
        nom: "Hypertension intracrânienne (HTIC)",
        description: "Augmentation de la pression dans le crâne. Causes multiples : tumeur, hydrocéphalie...",
        niveau: "rouge",
        criteres: [
            { texte: "Céphalées matinales", champ: "cephalee", op: "==", val: true },
            { texte: "Vomissements en jet", champ: "vomiFreq", op: "==", val: "incoercible" },
            { texte: "Troubles visuels", champ: "visionTrouble", op: "==", val: true },
            { texte: "Troubles de conscience", champ: "confusion", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.cephalee && data.vomissements && data.confusion && !data.fievre,
            message: "HTIC - Scanner URGENT - NE PAS faire de PL"
        },
        alertes: [
            "Troubles de conscience",
            "Anisocorie (mydriase unilatérale) = engagement",
            "Triade de Cushing (HTA + bradycardie + troubles respi)"
        ],
        conseils: [
            "Scanner cérébral URGENT",
            "NE PAS faire de PL si suspicion HTIC",
            "Position demi-assise",
            "Traitement selon cause"
        ],
        nonFaire: [
            "PL si HTIC suspectée (risque d'engagement)",
            "Retarder l'imagerie"
        ]
    },

    avc_pediatrique: {
        nom: "AVC pédiatrique",
        description: "Rare mais existe. Retard diagnostic fréquent car 'ça n'arrive pas aux enfants'.",
        niveau: "rouge",
        criteres: [
            { texte: "Déficit neurologique brutal", champ: "faiblesseMusculaire", op: "==", val: true },
            { texte: "Céphalée brutale intense", champ: "cephaleeType", op: "==", val: "brutal" },
            { texte: "Troubles de conscience", champ: "confusion", op: "==", val: true },
            { texte: "Convulsions", champ: "convulsions", op: "==", val: true },
            { texte: "Troubles visuels", champ: "visionTrouble", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.cephaleeType === 'brutal' && data.confusion && !data.fievre,
            message: "AVC - Imagerie URGENTE - Thrombolyse si < 4h30"
        },
        alertes: [
            "Tous ces signes = imagerie urgente"
        ],
        conseils: [
            "IRM cérébrale en urgence (ou scanner si IRM non dispo)",
            "Thrombolyse possible si < 4h30 (selon protocole)",
            "Recherche étiologique (cardiopathie, drépanocytose, SAPL...)"
        ],
        nonFaire: [
            "Retarder car 'c'est un enfant, ça ne peut pas être un AVC'"
        ]
    },

    // ============================================
    // INFECTIEUSES GRAVES
    // ============================================

    sepsis_choc: {
        nom: "Sepsis / Choc septique",
        description: "Réponse inflammatoire systémique à une infection. Mortalité élevée. Chaque heure compte.",
        niveau: "rouge",
        criteres: [
            { texte: "Fièvre (ou hypothermie)", champ: "fievre", op: "==", val: true },
            { texte: "Extrémités froides", champ: "extremitesFroides", op: "==", val: true },
            { texte: "Douleur HCD", champ: "abdoLoc", op: "==", val: "hcd" },
            { texte: "Ictère", champ: "ictere", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.abdoLoc === 'hcd' && data.ictere,
            message: "Intox paracétamol suspectée - NAC < 8h - Paracétamolémie H4"
        },
        alertes: [
            "Délai > 8h = efficacité antidote réduite",
            "Paracétamolémie H4"
        ],
        conseils: [
            "N-acétylcystéine (NAC) le plus tôt possible",
            "Efficace même après 8h (moins bien)",
            "Paracétamolémie à H4",
            "Charbon activé si < 1h"
        ],
        nonFaire: [
            "Se rassurer car 'pas de symptômes'",
            "Attendre les symptômes pour traiter"
        ]
    },

    intox_co: {
        nom: "Intoxication au monoxyde de carbone (CO)",
        description: "Gaz inodore. Céphalées + nausées touchant plusieurs personnes = évocateur. Urgence vitale.",
        niveau: "rouge",
        criteres: [
            { texte: "Céphalées", champ: "cephalee", op: "==", val: true },
            { texte: "Vertiges", champ: "vertiges", op: "==", val: true },
            { texte: "Nausées/vomissements", champ: "vomissements", op: "==", val: true },
            { texte: "Confusion", champ: "confusion", op: "==", val: true },
            { texte: "Cas groupés", champ: "collectivite", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Fièvre", champ: "fievre", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.cephalee && data.vertiges && data.collectivite && !data.fievre,
            message: "INTOX CO - Évacuer - O2 100% - SAMU"
        },
        alertes: [
            "Perte de connaissance",
            "Troubles du rythme",
            "Grossesse = urgence absolue"
        ],
        conseils: [
            "Évacuer les lieux, aérer",
            "Appeler les secours (15, 18)",
            "Oxygène 100% MHC",
            "Caisson hyperbare si formes graves"
        ],
        nonFaire: [
            "Rester dans les locaux"
        ]
    },

    // ============================================
    // URGENCES PÉDIATRIQUES SPÉCIFIQUES
    // ============================================

    kawasaki: {
        nom: "Maladie de Kawasaki",
        description: "Vascularite fébrile aiguë. Risque de complications coronariennes si non traitée. Urgence diagnostique.",
        niveau: "orange",
        criteres: [
            { texte: "Fièvre ≥ 5 jours", champ: "fievreDuree", op: "==", val: "5j-plus" },
            { texte: "Conjonctivite bilatérale", champ: "yeuxTypes", op: "contains", val: "rouge" },
            { texte: "Lèvres fissurées", champ: "levresFissures", op: "==", val: true },
            { texte: "Langue framboisée", champ: "langueType", op: "==", val: "framboise" },
            { texte: "Éruption cutanée", champ: "eruption", op: "==", val: true },
            { texte: "Ganglions cervicaux", champ: "ganglions", op: "==", val: true }
        ],
        exclusions: [
            { texte: "Toux", champ: "toux", op: "==", val: true },
            { texte: "Rhinite", champ: "nez", op: "==", val: true }
        ],
        urgence: {
            condition: (data) => data.fievreDuree === '5j-plus' && data.yeux && (data.levresFissures || data.langueType === 'framboise'),
            message: "KAWASAKI - Hospitalisation - Immunoglobulines - Risque coronarien"
        },
        alertes: [
            "Tous ces symptômes nécessitent une hospitalisation",
            "Risque d'anévrismes coronariens"
        ],
        conseils: [
            "Hospitalisation pour bilan et traitement (immunoglobulines)",
            "Échocardiographie systématique"
        ],
        nonFaire: [
            "Attendre que la fièvre passe"
        ]
    },

    anaphylaxie: {
        nom: "Réaction anaphylactique",
        description: "Réaction allergique sévère généralisée. URGENCE VITALE. Peut évoluer très rapidement.",
        niveau: "rouge",
        criteres: [
            { texte: "Urticaire/éruption généralisée", champ: "eruption", op: "==", val: true },
            { texte: "Gonflement visage/lèvres/langue", champ: "oedeme", op: "==", val: true },
            { texte: "Gonflement visage/lèvres/langue", champ: "oedemeLoc", op: "in", val: ["visage", "levres"] },
            { texte: "Difficultés respiratoires", champ: "respiration", op: "==", val: true },
            { texte: "Malaise/vertige", champ: "vertiges", op: "==", val: true },
            { texte: "Nausées/vomissements", champ: "nausees", op: "==", val: true },
            { texte: "Pâleur", champ: "paleur", op: "==", val: true }
        ],
        exclusions: [],
        urgence: {
            condition: (data) => data.eruption && (data.respiration || (data.oedeme && data.oedemeLoc === 'levres')),
            message: "ANAPHYLAXIE - ADRÉNALINE IM - SAMU"
        },
        alertes: [
            "TOUS ces symptômes sont des alertes majeures"
        ],
        conseils: [
            "APPELER LE 15 IMMÉDIATEMENT",
            "Adrénaline si stylo disponible (Anapen, EpiPen)",
            "Position allongée jambes surélevées (sauf si gêne respiratoire)",
            "Ne jamais laisser seul"
        ],
        nonFaire: [
            "Attendre",
            "Faire asseoir ou debout si malaise"
        ]
    }

};

// ============================================
// MOTEUR DE SCORING GÉNÉRIQUE
// ============================================

function evaluer(data, critere) {
    const v = data[critere.champ];
    
    // Gestion des valeurs vides/absentes
    if (v === null || v === undefined || v === '') {
        if (critere.op === '==' && critere.val === false) return true;
        if (critere.op === '!=' && critere.val === true) return true;
        return false;
    }
    
    switch (critere.op) {
        case '==': return v === critere.val;
        case '!=': return v !== critere.val;
        case '>=': return parseFloat(v) >= critere.val;
        case '<=': return parseFloat(v) <= critere.val;
        case '>': return parseFloat(v) > critere.val;
        case '<': return parseFloat(v) < critere.val;
        case 'in': return critere.val.includes(v);
        case 'contains': return Array.isArray(v) && v.includes(critere.val);
    }
    return false;
}

// Red flags : critères critiques pondérés x3
const RED_FLAGS = {
    // Champs booléens
    raideurNuque: true,
    kernig: true,
    brudzinski: true,
    convulsions: true,
    confusion: true,
    faiblesseMusculaire: true,
    // Valeurs spécifiques
    eruptionType: ['purpura'],
    respiType: ['tirage', 'cyanose'],
    paleurType: ['marbrures'],
    gorgeType: ['bave'],
    fatigueLevel: ['prostration'],
    vomiType: ['sang'],
    diarrheeType: ['sang'],
    diarrheeCouleur: ['sang', 'noire'],
    testiculeDebut: ['brutal'],
    cephaleeType: ['brutal']
};

function estRedFlag(critere, data) {
    const champ = critere.champ;
    const val = critere.val;
    
    // Si c'est un champ booléen red flag
    if (RED_FLAGS[champ] === true && val === true) {
        return true;
    }
    
    // Si c'est une valeur spécifique red flag
    if (Array.isArray(RED_FLAGS[champ])) {
        if (typeof val === 'string' && RED_FLAGS[champ].includes(val)) {
            return true;
        }
        // Pour les opérateurs 'in' avec des valeurs red flag
        if (critere.op === 'in' && Array.isArray(val)) {
            return val.some(v => RED_FLAGS[champ].includes(v));
        }
    }
    
    // Température >= 40
    if (champ === 'temp' && critere.op === '>=' && val >= 40) {
        return true;
    }
    
    return false;
}

function scorerMaladie(data, maladie) {
    let score = 0;
    let scoreMax = 0;
    let matches = [];
    
    // Critères positifs avec pondération
    for (const c of maladie.criteres) {
        const poids = estRedFlag(c, data) ? 3 : 1;
        scoreMax += poids;
        
        if (evaluer(data, c)) {
            score += poids;
            matches.push(c.texte);
        }
    }
    
    // Exclusions (diminuent le score de 1)
    for (const e of maladie.exclusions || []) {
        if (evaluer(data, e)) {
            score--;
            matches.push('(-) ' + e.texte);
        }
    }
    
    return {
        score: Math.max(0, score),
        max: scoreMax,
        pourcent: scoreMax > 0 ? Math.round(100 * Math.max(0, score) / scoreMax) : 0,
        matches: matches
    };
}

function scorer(data) {
    const resultats = [];
    const drapeaux = [];
    
    for (const [id, m] of Object.entries(maladiesDB)) {
        const r = scorerMaladie(data, m);
        
        // Seulement si score > 0
        if (r.score > 0) {
            resultats.push({
                id: id,
                nom: m.nom,
                niveau: m.niveau,
                description: m.description,
                score: r.score,
                max: r.max,
                pourcent: r.pourcent,
                matches: r.matches,
                alertes: m.alertes,
                conseils: m.conseils,
                nonFaire: m.nonFaire
            });
        }
        
        // Vérification urgences (red flags)
        if (m.urgence && m.urgence.condition(data)) {
            drapeaux.push({
                niveau: m.niveau,
                maladie: m.nom,
                message: m.urgence.message
            });
        }
    }
    
    // Tri par pourcentage décroissant
    resultats.sort((a, b) => b.pourcent - a.pourcent);
    
    return { resultats, drapeaux };
}

// Export pour utilisation
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { maladiesDB, evaluer, scorerMaladie, scorer };
}








// === SWITCH MODE ===
function switchMode(mode) {
    document.querySelectorAll('.mode-switch button').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('#mode-triage, #mode-reverse').forEach(d => d.classList.remove('active'));
    document.getElementById('mode-' + mode).classList.add('active');
    event.target.classList.add('active');
}

// === TOGGLE SUB-OPTIONS ===
function toggleSub(checkbox) {
    const subId = 'sub-' + checkbox.id;
    const subDiv = document.getElementById(subId);
    if (subDiv) subDiv.classList.toggle('visible', checkbox.checked);
}

// === COLLECTE DONNÉES ===
function getVal(name) {
    const el = document.querySelector(`input[name="${name}"]:checked`);
    return el ? el.value : null;
}
function isChecked(id) {
    const el = document.getElementById(id);
    return el ? el.checked : false;
}
function getCheckedValues(name) {
    const els = document.querySelectorAll(`input[name="${name}"]:checked`);
    return Array.from(els).map(e => e.value);
}

function collecterDonnees() {
    return {
        // État général
        fievre: isChecked('fievre'),
        temp: getVal('temp') ? parseFloat(getVal('temp')) : null,
        fievreDuree: getVal('fievre-duree'),
        fatigue: isChecked('fatigue'),
        fatigueLevel: getVal('fatigue-level'),
        appetit: isChecked('appetit'),
        frissons: isChecked('frissons'),
        courbatures: isChecked('courbatures'),
        douleurYeux: isChecked('douleur-yeux'),
        paleur: isChecked('paleur'),
        paleurType: getVal('paleur-type'),
        douleurThorax: isChecked('douleurThorax'),
        
        // Constantes vitales
        hasSpo2: isChecked('hasSpo2'),
        spo2Val: getVal('spo2-val'),
        hasFc: isChecked('hasFc'),
        fcAge: getVal('fc-age'),
        fcValue: document.getElementById('fc-value')?.value || null,
        hasFr: isChecked('hasFr'),
        frAge: getVal('fr-age'),
        frValue: document.getElementById('fr-value')?.value || null,
        hasTa: isChecked('hasTa'),
        taSys: document.getElementById('ta-sys')?.value || null,
        taDia: document.getElementById('ta-dia')?.value || null,
        hasGlycemie: isChecked('hasGlycemie'),
        glycemieVal: document.getElementById('glycemie-val')?.value || null,
        
        // ORL/Respi
        toux: isChecked('toux'),
        touxType: getVal('toux-type'),
        touxDuree: getVal('toux-duree'),
        touxQuinte: getCheckedValues('toux-quinte'),
        nez: isChecked('nez'),
        nezType: getVal('nez-type'),
        gorge: isChecked('gorge'),
        gorgeType: getVal('gorge-type'),
        voix: isChecked('voix'),
        respiration: isChecked('respiration'),
        respiType: getVal('respi-type'),
        oreille: isChecked('oreille'),
        oreilleEcoul: isChecked('oreilleEcoul'),
        anosmie: isChecked('anosmie'),
        difficulteParler: isChecked('difficulteParler'),
        
        // Digestif
        vomissements: isChecked('vomissements'),
        vomiType: getVal('vomi-type'),
        vomiFreq: getVal('vomi-freq'),
        diarrhee: isChecked('diarrhee'),
        diarrheeType: getVal('diarrhee-type'),
        diarrheeCouleur: getVal('diarrhee-couleur'),
        nausees: isChecked('nausees'),
        douleurAbdo: isChecked('douleurAbdo'),
        abdoLoc: getVal('abdo-loc'),
        abdoCarac: getCheckedValues('abdo-carac'),
        abdoAppend: getCheckedValues('abdo-append'),
        constipation: isChecked('constipation'),
        deshydratation: isChecked('deshydratation'),
        deshSignes: getCheckedValues('desh'),
        
        // Cutané
        eruption: isChecked('eruption'),
        eruptionType: getVal('eruption-type'),
        eruptionLoc: getCheckedValues('eruption-loc'),
        eruptionGratte: isChecked('eruptionGratte'),
        eruptionTexture: getCheckedValues('eruption-texture'),
        eruptionEvolution: getVal('eruption-evolution'),
        aphtes: isChecked('aphtes'),
        oedeme: isChecked('oedeme'),
        oedemeLoc: getVal('oedeme-loc'),
        ictere: isChecked('ictere'),
        saignements: isChecked('saignements'),
        saignSignes: getCheckedValues('saign'),
        
        // Neuro
        cephalee: isChecked('cephalee'),
        cephaleeType: getVal('cephalee-type'),
        raideurNuque: isChecked('raideurNuque'),
        kernig: isChecked('kernig'),
        brudzinski: isChecked('brudzinski'),
        convulsions: isChecked('convulsions'),
        confusion: isChecked('confusion'),
        vertiges: isChecked('vertiges'),
        photophobie: isChecked('photophobie'),
        visionTrouble: isChecked('visionTrouble'),
        paupieresTombantes: isChecked('paupieresTombantes'),
        faiblesseMusculaire: isChecked('faiblesseMusculaire'),
        paresthesies: isChecked('paresthesies'),
        
        // Autres
        ganglions: isChecked('ganglions'),
        ganglionsLoc: getVal('ganglions-loc'),
        yeux: isChecked('yeux'),
        yeuxTypes: getCheckedValues('yeux-type'),
        langue: isChecked('langue'),
        langueType: getVal('langue-type'),
        levresFissures: isChecked('levresFissures'),
        douleurArticulaire: isChecked('douleurArticulaire'),
        articIntensite: getVal('artic-intensite'),
        
        // Urinaire
        urinaire: isChecked('urinaire'),
        urinaireTypes: getCheckedValues('urinaire-types'),
        urinesCouleur: getVal('urines-couleur'),
        douleurLombaire: isChecked('douleurLombaire'),
        
        // Ostéo
        douleurMembre: isChecked('douleurMembre'),
        membreSignes: getCheckedValues('membre-signes'),
        douleurEpaule: isChecked('douleurEpaule'),
        
        // Génital garçon
        douleurTesticule: isChecked('douleurTesticule'),
        testiculeDebut: getVal('testicule-debut'),
        testiculeSignes: getCheckedValues('testicule-signes'),
        
        // Gynéco
        douleurPelvienne: isChecked('douleurPelvienne'),
        pelvienDebut: getVal('pelvien-debut'),
        metrorragies: isChecked('metrorragies'),
        retardRegles: isChecked('retardRegles'),
        grossessePossible: isChecked('grossessePossible'),
        
        // Contexte
        repasSuspect: isChecked('repasSuspect'),
        conserveMaison: isChecked('conserveMaison'),
        collectivite: isChecked('collectivite'),
        baignade: isChecked('baignade'),
        drepanocytose: isChecked('drepanocytose'),
        asthme: isChecked('asthme'),
        asthmeTriggers: getCheckedValues('asthme-trigger'),
        immunodepression: isChecked('immunodepression'),
        zonePalu: isChecked('zonePalu'),
        paluZone: getVal('palu-zone'),
        vaccinStatut: getVal('vaccin-statut')
    };
}

// === MAPPING CHAMPS DB -> DONNÉES UTILISATEUR ===
// Pour savoir si un critère de la DB est coché par l'utilisateur
function champEstCoche(data, critere) {
    return evaluer(data, critere);
}

// === ANALYSER ===
function analyser() {
    const data = collecterDonnees();
    console.log('Données:', data);
    
    // Vérifier qu'il y a au moins un symptôme
    const hasSymptom = Object.values(data).some(v => v === true || (Array.isArray(v) && v.length > 0) || (typeof v === 'number'));
    if (!hasSymptom) {
        alert('Veuillez cocher au moins un symptôme.');
        return;
    }
    
    // Utiliser le scorer de maladiesDB.js
    const { resultats, drapeaux } = scorer(data);
    
    // IDs des maladies avec drapeau d'urgence
    const maladiesAvecDrapeau = new Set(drapeaux.map(d => {
        // Trouver l'ID de la maladie depuis son nom
        for (const [id, m] of Object.entries(maladiesDB)) {
            if (m.nom === d.maladie) return id;
        }
        return null;
    }).filter(Boolean));
    
    // Filtrer selon seuil : 2/3, 3/4, 4/5+
    // SAUF si la maladie a un drapeau d'urgence
    const resultatsFiltres = resultats.filter(r => {
        // Toujours garder les maladies avec drapeau
        if (maladiesAvecDrapeau.has(r.id)) return true;
        
        const nbCriteres = r.max;
        const nbMatchsPositifs = r.matches.filter(m => !m.startsWith('(-)')).length;
        if (nbCriteres <= 3) return nbMatchsPositifs >= 2;
        if (nbCriteres === 4) return nbMatchsPositifs >= 3;
        return nbMatchsPositifs >= 4; // 5 critères ou plus
    });
    
    afficherResultat(resultatsFiltres, drapeaux, data);
}

// === TRIAGE OFFICIEL (CTAS / ESI / FRENCH) ===
function calculerTriageOfficiel(data, drapeaux) {
    
    // Analyse des constantes vitales
    let fcAlerte = null;
    if (data.hasFc && data.fcValue && data.fcAge) {
        const fc = parseInt(data.fcValue);
        const fcMax = { '6-8': 110, '9-12': 105, '13-15': 100 };
        const fcMin = { '6-8': 70, '9-12': 65, '13-15': 60 };
        if (fc > 170 || fc < 50) fcAlerte = 'rouge';
        else if (fc > fcMax[data.fcAge] + 30 || fc < fcMin[data.fcAge] - 10) fcAlerte = 'orange';
    }
    
    let frAlerte = null;
    if (data.hasFr && data.frValue && data.frAge) {
        const fr = parseInt(data.frValue);
        const frMax = { '6-8': 24, '9-12': 22, '13-15': 20 };
        if (fr > 40 || fr < 10) frAlerte = 'rouge';
        else if (fr > frMax[data.frAge] + 8) frAlerte = 'orange';
    }
    
    let taAlerte = null;
    if (data.hasTa && data.taSys) {
        const sys = parseInt(data.taSys);
        if (sys < 70 || sys > 180) taAlerte = 'rouge';
        else if (sys < 85 || sys > 140) taAlerte = 'orange';
    }
    
    let glycemieAlerte = null;
    if (data.hasGlycemie && data.glycemieVal) {
        const gly = parseFloat(data.glycemieVal);
        if (gly < 0.4 || gly > 4) glycemieAlerte = 'rouge';
        else if (gly < 0.6 || gly > 2.5) glycemieAlerte = 'orange';
    }
    
    // ===== CTAS (Canadian Triage and Acuity Scale) =====
    let ctas = 5;
    let ctasRaison = "Pas de critère de gravité identifié";
    
    // CTAS 1 - Réanimation
    if (drapeaux.length > 0 ||
        data.convulsions ||
        data.respiType === 'cyanose' ||
        data.fatigueLevel === 'prostration' ||
        data.confusion ||
        (data.faiblesseMusculaire && data.respiration) ||
        (data.hasSpo2 && data.spo2Val === '90') ||
        fcAlerte === 'rouge' || frAlerte === 'rouge' || taAlerte === 'rouge' || glycemieAlerte === 'rouge') {
        ctas = 1;
        ctasRaison = "Détresse vitale / Drapeau rouge critique";
    }
    // CTAS 2 - Très urgent
    else if (
        data.respiType === 'tirage' ||
        (data.hasSpo2 && data.spo2Val === '92') ||
        data.cephaleeType === 'brutal' ||
        data.paleurType === 'marbrures' ||
        data.gorgeType === 'bave' ||
        (data.fievre && data.temp >= 40 && data.fatigueLevel === 'marquee') ||
        (data.fievre && data.raideurNuque) ||
        (data.fievre && data.eruptionType === 'purpura') ||
        (data.abdoCarac && data.abdoCarac.includes('defense')) ||
        (data.saignements && data.fievre) ||
        fcAlerte === 'orange' || frAlerte === 'orange' || taAlerte === 'orange' || glycemieAlerte === 'orange') {
        ctas = 2;
        ctasRaison = "Signes de gravité nécessitant évaluation rapide";
    }
    // CTAS 3 - Urgent
    else if (
        (data.fievre && data.temp >= 39) ||
        data.deshydratation ||
        data.vomiFreq === 'incoercible' ||
        data.respiType === 'rapide' || data.respiType === 'sifflante' ||
        data.touxType === 'aboyante' ||
        (data.douleurAbdo && data.abdoLoc === 'fid') ||
        (data.douleurLombaire && data.fievre) ||
        data.ictere) {
        ctas = 3;
        ctasRaison = "Symptômes nécessitant évaluation dans les 30 min";
    }
    // CTAS 4 - Moins urgent
    else if (
        (data.fievre && data.temp >= 38) ||
        data.toux || data.nez || data.gorge ||
        data.oreille ||
        data.vomissements || data.diarrhee ||
        data.douleurAbdo ||
        data.eruption ||
        data.urinaire) {
        ctas = 4;
        ctasRaison = "Symptômes stables, évaluation dans l'heure";
    }
    
    // ===== ESI (Emergency Severity Index, USA) =====
    let esi = 5;
    let esiRaison = "Consultation simple, peu de ressources";
    
    // ESI 1 - Intervention immédiate
    if (drapeaux.length > 0 ||
        data.convulsions ||
        data.respiType === 'cyanose' ||
        data.fatigueLevel === 'prostration' ||
        (data.faiblesseMusculaire && data.respiration) ||
        (data.hasSpo2 && data.spo2Val === '90') ||
        fcAlerte === 'rouge' || frAlerte === 'rouge' || taAlerte === 'rouge' || glycemieAlerte === 'rouge') {
        esi = 1;
        esiRaison = "Intervention vitale immédiate requise";
    }
    // ESI 2 - Haut risque
    else if (
        data.confusion ||
        data.respiType === 'tirage' ||
        (data.hasSpo2 && data.spo2Val === '92') ||
        data.cephaleeType === 'brutal' ||
        (data.abdoCarac && data.abdoCarac.includes('defense')) ||
        (data.fievre && data.temp >= 40) ||
        data.paleurType === 'marbrures' ||
        data.gorgeType === 'bave' ||
        fcAlerte === 'orange' || frAlerte === 'orange' || taAlerte === 'orange' || glycemieAlerte === 'orange') {
        esi = 2;
        esiRaison = "Haut risque, ne doit pas attendre";
    }
    // ESI 3 - Multiple ressources
    else if (
        (data.fievre && data.temp >= 39) ||
        data.deshydratation ||
        (data.douleurAbdo && (data.abdoLoc === 'fid' || (data.abdoCarac && data.abdoCarac.includes('migration')))) ||
        (data.douleurLombaire && data.fievre) ||
        data.respiration ||
        data.ictere ||
        (data.membreSignes && data.membreSignes.includes('gonfle') && data.fievre)) {
        esi = 3;
        esiRaison = "Plusieurs examens/ressources probables";
    }
    // ESI 4 - Une ressource
    else if (
        data.fievre ||
        data.oreille ||
        data.gorge ||
        data.urinaire ||
        data.eruption ||
        data.vomissements || data.diarrhee) {
        esi = 4;
        esiRaison = "Une ressource (exam/prescription) probable";
    }
    
    // ===== FRENCH (SAMU / SFMU) =====
    let french = 4;
    let frenchRaison = "Consultation de médecine générale";
    
    // P1 - Urgence absolue
    if (drapeaux.length > 0 ||
        data.convulsions ||
        data.respiType === 'cyanose' ||
        data.fatigueLevel === 'prostration' ||
        data.confusion ||
        (data.fievre && data.raideurNuque) ||
        (data.fievre && data.eruptionType === 'purpura') ||
        (data.faiblesseMusculaire && data.respiration) ||
        (data.oedemeLoc === 'levres' && data.respiration) ||
        (data.hasSpo2 && data.spo2Val === '90') ||
        fcAlerte === 'rouge' || frAlerte === 'rouge' || taAlerte === 'rouge' || glycemieAlerte === 'rouge') {
        french = 1;
        frenchRaison = "Urgence vitale - SAMU 15";
    }
    // P2 - Urgence vraie
    else if (
        data.respiType === 'tirage' ||
        (data.abdoCarac && data.abdoCarac.includes('defense')) ||
        (data.fievre && data.temp >= 40) ||
        data.paleurType === 'marbrures' ||
        data.cephaleeType === 'brutal' ||
        data.gorgeType === 'bave' ||
        (data.saignements && data.fievre) ||
        (data.hasSpo2 && data.spo2Val === '92') ||
        fcAlerte === 'orange' || frAlerte === 'orange' || taAlerte === 'orange' || glycemieAlerte === 'orange') {
        french = 2;
        frenchRaison = "Urgence vraie - Consultation immédiate";
    }
    // P3 - Urgence relative
    else if (
        (data.fievre && data.temp >= 39) ||
        data.deshydratation ||
        data.vomiFreq === 'incoercible' ||
        data.touxType === 'aboyante' ||
        (data.douleurAbdo && data.abdoLoc === 'fid') ||
        (data.douleurLombaire && data.fievre) ||
        data.ictere ||
        data.respiration) {
        french = 3;
        frenchRaison = "Urgence relative - Consultation dans la journée";
    }
    
    return {
        ctas: { niveau: ctas, raison: ctasRaison },
        esi: { niveau: esi, raison: esiRaison },
        french: { niveau: french, raison: frenchRaison },
        alertesConstantes: { fc: fcAlerte, fr: frAlerte, ta: taAlerte, glycemie: glycemieAlerte }
    };
}

// === AFFICHAGE RÉSULTATS AVEC CRITÈRES COLORÉS ===
function afficherResultat(resultats, drapeaux, data) {
    const div = document.getElementById('resultat');
    let html = '';
    
    // Déterminer niveau global
    let niveau = 'vert';
    if (drapeaux.length > 0) niveau = 'rouge';
    else if (resultats.length > 0 && resultats[0].niveau === 'rouge') niveau = 'rouge';
    else if (resultats.length > 0 && resultats[0].niveau === 'orange') niveau = 'orange';
    else if (resultats.length > 0) niveau = 'jaune';
    
    const niveaux = {
        rouge: { icon: '🚨', titre: 'URGENCE - Appeler le 15' },
        orange: { icon: '⚠️', titre: 'Consultation dans la journée' },
        jaune: { icon: '📋', titre: 'Consultation sous 24-48h' },
        vert: { icon: '🏠', titre: 'Surveillance à domicile' }
    };
    
    div.className = 'niveau-' + niveau;
    html += `<h3><span style="font-size:1.5em">${niveaux[niveau].icon}</span> ${niveaux[niveau].titre}</h3>`;
    
    // Drapeaux rouges
    if (drapeaux.length > 0) {
        html += '<div class="alerte-rouge"><h4>⚠️ ALERTES URGENTES</h4>';
        drapeaux.forEach(d => html += `<p><strong>${d.maladie}</strong>: ${d.message}</p>`);
        html += '</div>';
    }
    
    // Pathologies candidates avec critères colorés
    if (resultats.length > 0) {
        html += '<div class="pathologies-probables"><h4>🩺 Hypothèses diagnostiques</h4>';
        
        resultats.slice(0, 8).forEach((r, idx) => {
            const m = maladiesDB[r.id];
            html += `<div class="patho-card ${idx === 0 ? 'top' : ''}">`;
            
            // Header
            html += '<div class="patho-header">';
            html += `<strong>${getNiveauIcon(r.niveau)} ${r.nom}</strong>`;
            html += `<span class="patho-score">${r.pourcent}%</span>`;
            html += '</div>';
            
            // Description
            html += `<div class="patho-desc">${r.description}</div>`;
            
            // CRITÈRES ATTENDUS (bleu pâle, cerclé vert si coché)
            // Dédoupliquer par texte, mais cercler vert si AU MOINS UN critère avec ce texte matche
            const criteresParTexte = {};
            m.criteres.forEach(c => {
                if (!criteresParTexte[c.texte]) criteresParTexte[c.texte] = [];
                criteresParTexte[c.texte].push(c);
            });
            html += '<div><small><strong>Critères attendus :</strong></small>';
            html += '<div class="criteres-box">';
            for (const [texte, criteres] of Object.entries(criteresParTexte)) {
                const match = criteres.some(c => champEstCoche(data, c));
                html += `<span class="critere-tag critere-attendu ${match ? 'critere-match' : ''}">${texte}</span>`;
            }
            html += '</div></div>';
            
            // EXCLUSIONS (rouge pâle, cerclé vert si coché = problème)
            if (m.exclusions && m.exclusions.length > 0) {
                const exclusionsParTexte = {};
                m.exclusions.forEach(e => {
                    if (!exclusionsParTexte[e.texte]) exclusionsParTexte[e.texte] = [];
                    exclusionsParTexte[e.texte].push(e);
                });
                html += '<div style="margin-top:6px"><small><strong>Filtres négatifs :</strong></small>';
                html += '<div class="criteres-box">';
                for (const [texte, exclusions] of Object.entries(exclusionsParTexte)) {
                    const match = exclusions.some(e => champEstCoche(data, e));
                    html += `<span class="critere-tag critere-exclusion ${match ? 'critere-match' : ''}">${texte}</span>`;
                }
                html += '</div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
    } else {
        html += '<div class="pathologies-probables"><p>Aucune pathologie ne correspond précisément aux symptômes sélectionnés.</p></div>';
    }
    
    // Conseils
    html += '<div class="conseils"><h4>💡 Conseils généraux</h4><ul>';
    if (niveau === 'rouge') {
        html += '<li><strong>Appelez le 15 (SAMU)</strong> ou rendez-vous aux urgences</li>';
    } else if (niveau === 'orange') {
        html += '<li>Consultez un médecin aujourd\'hui</li>';
        html += '<li>Si aggravation : appelez le 15</li>';
    } else if (niveau === 'jaune') {
        html += '<li>Prenez rendez-vous avec votre médecin</li>';
        html += '<li>Hydratation et repos en attendant</li>';
    } else {
        html += '<li>Repos et hydratation</li>';
        html += '<li>Paracétamol si fièvre ou douleur</li>';
    }
    html += '</ul></div>';
    
    // Triage officiel (CTAS / ESI / SAMU)
    const triageOfficiel = calculerTriageOfficiel(data, drapeaux);
    
    html += '<div class="pathologies-probables" style="margin-top: 20px; background: #f8f9fa; border: 2px solid #6c757d;">';
    html += '<h4>📊 Niveaux de triage (protocoles officiels)</h4>';
    html += '<p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">Classification selon 3 standards internationaux :</p>';
    
    // CTAS
    const ctasColors = ['', '#dc3545', '#fd7e14', '#ffc107', '#28a745', '#17a2b8'];
    const ctasLabels = ['', 'Réanimation', 'Très urgent', 'Urgent', 'Moins urgent', 'Non urgent'];
    const ctasDelais = ['', 'Immédiat', '< 15 min', '< 30 min', '< 60 min', '< 120 min'];
    html += `<div style="display: flex; align-items: center; padding: 10px; margin: 5px 0; background: white; border-radius: 6px; border-left: 4px solid ${ctasColors[triageOfficiel.ctas.niveau]};">`;
    html += `<span style="font-weight: bold; min-width: 120px;">🇨🇦 CTAS</span>`;
    html += `<span style="background: ${ctasColors[triageOfficiel.ctas.niveau]}; color: white; padding: 4px 12px; border-radius: 12px; font-weight: bold; margin-right: 10px;">Niveau ${triageOfficiel.ctas.niveau}</span>`;
    html += `<span style="flex: 1;">${ctasLabels[triageOfficiel.ctas.niveau]} (${ctasDelais[triageOfficiel.ctas.niveau]})</span>`;
    html += `</div>`;
    
    // ESI
    const esiColors = ['', '#dc3545', '#fd7e14', '#ffc107', '#28a745', '#17a2b8'];
    const esiLabels = ['', 'Réanimation', 'Haut risque', 'Urgence', 'Peu urgent', 'Non urgent'];
    html += `<div style="display: flex; align-items: center; padding: 10px; margin: 5px 0; background: white; border-radius: 6px; border-left: 4px solid ${esiColors[triageOfficiel.esi.niveau]};">`;
    html += `<span style="font-weight: bold; min-width: 120px;">🇺🇸 ESI</span>`;
    html += `<span style="background: ${esiColors[triageOfficiel.esi.niveau]}; color: white; padding: 4px 12px; border-radius: 12px; font-weight: bold; margin-right: 10px;">Niveau ${triageOfficiel.esi.niveau}</span>`;
    html += `<span style="flex: 1;">${esiLabels[triageOfficiel.esi.niveau]}</span>`;
    html += `</div>`;
    
    // French SAMU
    const frenchColors = ['', '#dc3545', '#fd7e14', '#ffc107', '#28a745'];
    const frenchLabels = ['', 'P1 - Urgence absolue', 'P2 - Urgence vraie', 'P3 - Urgence relative', 'P4 - Consultation'];
    html += `<div style="display: flex; align-items: center; padding: 10px; margin: 5px 0; background: white; border-radius: 6px; border-left: 4px solid ${frenchColors[triageOfficiel.french.niveau]};">`;
    html += `<span style="font-weight: bold; min-width: 120px;">🇫🇷 SAMU</span>`;
    html += `<span style="background: ${frenchColors[triageOfficiel.french.niveau]}; color: white; padding: 4px 12px; border-radius: 12px; font-weight: bold; margin-right: 10px;">${frenchLabels[triageOfficiel.french.niveau].split(' - ')[0]}</span>`;
    html += `<span style="flex: 1;">${frenchLabels[triageOfficiel.french.niveau].split(' - ')[1] || ''}</span>`;
    html += `</div>`;
    
    html += '<p style="font-size: 0.8em; color: #888; margin-top: 10px; margin-bottom: 0;">⚖️ Ces classifications sont indicatives et ne remplacent pas l\'avis médical.</p>';
    html += '</div>';
    
    // Alertes constantes vitales
    const ac = triageOfficiel.alertesConstantes;
    if (ac.fc || ac.fr || ac.ta || ac.glycemie) {
        html += '<div class="pathologies-probables" style="margin-top: 15px; background: #fff3cd; border: 2px solid #ffc107;">';
        html += '<h4>⚠️ Constantes vitales anormales</h4><ul>';
        if (ac.fc === 'rouge') html += '<li style="color:#dc3545"><strong>FC critique</strong> - Bradycardie/tachycardie sévère</li>';
        else if (ac.fc === 'orange') html += '<li style="color:#fd7e14"><strong>FC anormale</strong> - À surveiller</li>';
        if (ac.fr === 'rouge') html += '<li style="color:#dc3545"><strong>FR critique</strong> - Détresse respiratoire</li>';
        else if (ac.fr === 'orange') html += '<li style="color:#fd7e14"><strong>FR élevée</strong> - Polypnée</li>';
        if (ac.ta === 'rouge') html += '<li style="color:#dc3545"><strong>TA critique</strong> - Choc ou HTA sévère</li>';
        else if (ac.ta === 'orange') html += '<li style="color:#fd7e14"><strong>TA anormale</strong> - À surveiller</li>';
        if (ac.glycemie === 'rouge') html += '<li style="color:#dc3545"><strong>Glycémie critique</strong> - Hypo/hyperglycémie sévère</li>';
        else if (ac.glycemie === 'orange') html += '<li style="color:#fd7e14"><strong>Glycémie anormale</strong> - À contrôler</li>';
        html += '</ul></div>';
    }
    
    // Surveillance
    html += '<div class="surveillance"><h4>👁️ Reconsulter si :</h4><ul>';
    html += '<li>Fièvre > 48-72h ou aggravation</li>';
    html += '<li>Difficultés respiratoires</li>';
    html += '<li>Prostration, somnolence</li>';
    html += '<li>Refus de boire</li>';
    html += '<li>Éruption qui ne s\'efface pas</li>';
    html += '</ul></div>';
    
    div.innerHTML = html;
    div.style.display = 'block';
    div.scrollIntoView({ behavior: 'smooth' });
}

function getNiveauIcon(niveau) {
    const icons = { vert: '🟢', jaune: '🟡', orange: '🟠', rouge: '🔴' };
    return icons[niveau] || '⚪';
}

// === RESET ===
function resetForm() {
    document.querySelectorAll('input[type="checkbox"]').forEach(e => e.checked = false);
    document.querySelectorAll('input[type="radio"]').forEach(e => e.checked = false);
    document.querySelectorAll('.sub-options').forEach(e => e.classList.remove('visible'));
    document.getElementById('resultat').style.display = 'none';
}

// === MODE RÉFÉRENCE : LISTE DYNAMIQUE ===
function genererListeMaladies() {
    const select = document.getElementById('maladie-select');
    
    // Grouper par catégorie (basé sur la position dans la DB)
    const categories = {};
    for (const [id, m] of Object.entries(maladiesDB)) {
        // Déduire catégorie depuis le nom ou utiliser "Autre"
        let cat = 'Autre';
        if (/rhino|angine|otite|laryngite|bronchite|pneumonie|grippe|covid|coqueluche/i.test(id)) cat = 'ORL / Respiratoire';
        else if (/gastro|tiac|appendicite|occlusion|hepatite|invagination|volvulus|pancreatite/i.test(id)) cat = 'Digestif';
        else if (/varicelle|pmb|urticaire|scarlatine|roseole|rougeole|impetigo/i.test(id)) cat = 'Cutané';
        else if (/dengue|chikungunya|leptospirose|palu/i.test(id)) cat = 'Arboviroses / Tropical';
        else if (/meningite|encephalite|guillain|htic|avc/i.test(id)) cat = 'Neurologique';
        else if (/kawasaki|anaphylaxie/i.test(id)) cat = 'Urgences pédiatriques';
        else if (/cystite|pyelonephrite|torsion|geu/i.test(id)) cat = 'Uro-génital';
        else if (/myocardite|pericardite|endocardite/i.test(id)) cat = 'Cardiovasculaire';
        else if (/drepa|shu|leucemie/i.test(id)) cat = 'Hématologique';
        else if (/intox|botulisme/i.test(id)) cat = 'Toxicologique';
        
        if (!categories[cat]) categories[cat] = [];
        categories[cat].push({ id, nom: m.nom });
    }
    
    // Générer les optgroups
    for (const [cat, maladies] of Object.entries(categories)) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = cat;
        maladies.sort((a, b) => a.nom.localeCompare(b.nom));
        maladies.forEach(m => {
            const opt = document.createElement('option');
            opt.value = m.id;
            opt.textContent = m.nom;
            optgroup.appendChild(opt);
        });
        select.appendChild(optgroup);
    }
}

// === AFFICHER MALADIE (RÉFÉRENCE) ===
function afficherMaladie() {
    const select = document.getElementById('maladie-select');
    const detailDiv = document.getElementById('maladie-detail');
    const maladieKey = select.value;
    
    if (!maladieKey) {
        detailDiv.innerHTML = '';
        return;
    }
    
    const m = maladiesDB[maladieKey];
    if (!m) return;
    
    const niveauLabels = {
        vert: '🟢 Surveillance à domicile',
        jaune: '🟡 Consultation sous 24-48h',
        orange: '🟠 Consultation dans la journée',
        rouge: '🔴 URGENCE - Appeler le 15'
    };
    
    let html = '<div class="maladie-detail">';
    html += `<h3>${m.nom}</h3>`;
    html += `<p>${m.description}</p>`;
    html += `<span class="section-niveau niveau-${m.niveau}">${niveauLabels[m.niveau]}</span>`;
    
    // Critères (symptômes attendus)
    if (m.criteres && m.criteres.length > 0) {
        html += '<div class="maladie-section section-symptomes">';
        html += '<h4>✅ Symptômes typiques</h4><ul>';
        m.criteres.forEach(c => html += `<li>${c.texte}</li>`);
        html += '</ul></div>';
    }
    
    // Exclusions (symptômes absents)
    if (m.exclusions && m.exclusions.length > 0) {
        html += '<div class="maladie-section section-absents">';
        html += '<h4>❌ Symptômes habituellement absents</h4><ul>';
        m.exclusions.forEach(e => html += `<li>${e.texte}</li>`);
        html += '</ul></div>';
    }
    
    // Alertes
    if (m.alertes && m.alertes.length > 0) {
        html += '<div class="maladie-section section-alertes">';
        html += '<h4>⚠️ Signes d\'alerte</h4><ul>';
        m.alertes.forEach(a => html += `<li>${a}</li>`);
        html += '</ul></div>';
    }
    
    // Conseils
    if (m.conseils && m.conseils.length > 0) {
        html += '<div class="maladie-section section-conseils">';
        html += '<h4>💡 Conseils</h4><ul>';
        m.conseils.forEach(c => html += `<li>${c}</li>`);
        html += '</ul></div>';
    }
    
    // À ne pas faire
    if (m.nonFaire && m.nonFaire.length > 0) {
        html += '<div class="maladie-section section-alertes">';
        html += '<h4>🚫 À ne PAS faire</h4><ul>';
        m.nonFaire.forEach(n => html += `<li>${n}</li>`);
        html += '</ul></div>';
    }
    
    html += '</div>';
    detailDiv.innerHTML = html;
}

// === INIT ===
document.addEventListener('DOMContentLoaded', function() {
    if (typeof maladiesDB !== 'undefined') {
        genererListeMaladies();
    } else {
        console.error('maladiesDB.js non chargé');
    }
});
</script>
</body>
</html>
